var wtAdTracer=function(){"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function e(e,n){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=function(e,n){if(e){if("string"==typeof e)return t(e,n);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?t(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){i&&(e=i);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(i=e[Symbol.iterator]()).next.bind(i)}var n,i=function(){function t(){this.player=void 0,this.utils=void 0,this.SHORT_NAME="Must be implemented",this.PLAYER_EVENTS={}}var e=t.prototype;return e.start=function(){},e.getVideoSlot=function(){},e.getMediaId=function(){},e.getPlayerId=function(){},e.getPlayerVersion=function(){},e.getAdBlock=function(){},e.getAdMgV=function(){},e.getIdx=function(){},e.getPercentViewable=function(){},e.getIsLive=function(){},t}(),o={endpoint:"https://c.p2r14.com/v5/in",batchSize:5,batchInterval:1e3,debug:!1},a={0:[]},r=0,s=!1,l=!1,d=function(){if(o.debug)try{for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];console.warn.apply(null,["%cWTAT.stream","background:#ffd400;color:#000;padding:2px"].concat(e))}catch(t){}};function u(){o.batchInterval>0&&(n=setInterval(g,o.batchInterval))}function c(){clearInterval(n)}function g(){if(!s){s=!0,c();var t=r;a[r+1]=[],r++,a[t].length&&function(t,e){d("sending",t);try{var n=JSON.stringify(t);if(navigator.sendBeacon){var i=new FormData;i.append("batch",n),i.append("apiKey",o.apiKey),navigator.sendBeacon(o.endpoint,i)||d("beacon queue error"),p(e)}else{var a=new XMLHttpRequest;a.open("POST",o.endpoint,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.setRequestHeader("x-api-key",o.apiKey),a.setRequestHeader("Connection","keep-alive"),a.onreadystatechange=function(){p(e)},a.send("batch="+encodeURIComponent(n))}}catch(t){d("xhr error",t.message)}}(a[t],t),s=!1,u()}}function p(t){delete a[t]}var y=function(){function t(t){void 0===t&&(t={}),o=Object.assign(o,t),u()}var e=t.prototype;return e.push=function(t){!l&&t&&(d("received",t),a[r].push(t),a[r].length>=o.batchSize&&g())},e.stop=function(){l=!0,a[r].length&&g(),c()},t}(),f=function(t,e){var n,i=this;this.options={debug:!1,sendAllCustom:!1},this.sessionId=void 0,this.loopIdx=0,this.staticData={},this.sessionFlags={},this.env={},this.stream=void 0,this.createGuid=function(){for(var t="",e=0;e<12;e++)t+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXZY01234567890".charAt(Math.floor(64*Math.random()));return Date.now()+"-"+t},this.createSession=function(){var t,e,n=!1;try{n=!!window.top.innerWidth||!!window.top.document.documentElement.clientWidth||!!window.top.document.body.clientWidth}catch(t){}i.sessionFlags={firstTimeDataSent:!1,isFif:n,sessionStartTime:Date.now()},i.sessionId=i.createGuid(),0===i.loopIdx&&(i.playlistId=i.createGuid()),i.loopIdx+=1;var o=function(){var t,e;try{var n=w(window.top);t=n[0],e=n[1]}catch(t){}if(!t){var i=window,o=w(i);t=o[0],e=o[1];try{for(;i.parent&&i!==i.parent;){var a=w(i.parent);t=a[0],e=a[1],i=i.parent}}catch(t){}}return[t,e]}();return i.sessionFlags.ww=o[0],i.sessionFlags.wh=o[1],i.sessionFlags.pu=function(t){var e=document.referrer;!e&&t&&(e=document.documentURI);try{var n,i;(window.location===window.parent.location||!e&&(null==(n=document)||null==(i=n.location)?void 0:i.href))&&(e=document.location.href)}catch(t){}return e}(n),i.staticData={rid:i.sessionId,idx:(null==(t=i.env)||null==t.getIdx?void 0:t.getIdx())||i.loopIdx,plGid:i.playlistId,src:i.options.src,v:i.options.v,plV:null==(e=i.env)||null==e.getPlayerVersion?void 0:e.getPlayerVersion(),fif:+i.sessionFlags.isFif,domain:b(i.sessionFlags.pu)},i.sessionId},this.sendData=function(t){i.stream.push(i.gatherData(t))},this.gatherData=function(t){var e,n,o;void 0===t&&(t={});var a,r=Object.assign({},t,i.staticData,{mediaId:null==(e=i.env)||null==e.getMediaId?void 0:e.getMediaId(),playerId:null==(n=i.env)||null==n.getPlayerId?void 0:n.getPlayerId(),cst:Date.now()-i.sessionFlags.sessionStartTime,pVisible:h(),isLive:null==(o=i.env)||null==o.getIsLive?void 0:o.getIsLive()});i.sessionFlags.firstTimeDataSent||(i.sessionFlags.firstTimeDataSent=!0,r.cst=0,r.ww=i.sessionFlags.ww,r.wh=i.sessionFlags.wh,r.pu=i.sessionFlags.pu);try{var s=i.env.getVideoSlot();if(s){var l,d;r.per=null!=(l=null==(d=i.env)||null==d.getPercentViewable?void 0:d.getPercentViewable())?l:function(t,e){if(!t)return;try{var n=window.getComputedStyle(t,null),i=n.getPropertyValue("visibility"),o=n.getPropertyValue("display");if("hidden"===i||"none"===o)return 0;try{if(e){var a=w(window.top),r=a[0],s=a[1],l=t.getBoundingClientRect(),d=0,u=0;if(r===1/0||s===1/0)return;var c=m(t,window);try{d=c.bottom<0||c.top>s?0:c.top<s&&c.bottom>s?(s-c.top)/l.height*100:c.top<0&&c.bottom>0?c.bottom/l.height*100:100,u=c.right<0||c.left>r?0:c.right<r&&c.left>r?(r-c.right)/l.width*100:c.left<0&&c.right>0?c.right/l.width*100:100}catch(t){return}return parseInt(u*d/100,10)}}catch(t){}}catch(t){}}(s,i.sessionFlags.isFif);var u=s.getBoundingClientRect();r.w=parseInt(u.width,10),r.h=parseInt(u.height,10)}}catch(t){i.log("gatherData ERROR reading ad WxH:",t.message)}try{var c=v(window,["wtatCustom","fields"],{});Object.keys(c).length&&(r.custom=r.custom||{},Object.entries(c).forEach((function(t){var e=t[0],n=t[1];"function"==typeof n?r.custom[e]=n(r):!i.options.sendAllCustom&&i.sessionFlags.staticCustomSent||(r.custom[e]=n)}))),i.sessionFlags.staticCustomSent=!0}catch(t){i.log("gatherData error",t.message)}if(a=r,!v(window,["wtatCustom","ignoredEvents"],[]).some((function(t){return Object.entries(t).every((function(t){var e=t[0],n=t[1];return v(a,e)===n}))})))return r},this.logger=function(t){return function(){if(i.options.debug)try{for(var e,n,o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];console.warn.apply(null,["%c"+t+" "+(null!=(e=null==(n=i.env)||null==n.getPlayerId?void 0:n.getPlayerId())?e:""),"background:#ffd400;color:#000;padding:2px"].concat(a))}catch(t){}}},this.options=Object.assign(this.options,t),this.env=e;var o={debug:this.options.debug,apiKey:this.options.apiKey};this.options.wtUrl&&(o.endpoint=this.options.wtUrl),window&&window.wtStream?this.stream=window.wtStream:(this.stream=new y(o),window&&(window.wtStream=this.stream)),this.log=this.logger("WTAT.core",this.options.debug,null==(n=this.env)||null==n.getPlayerId?void 0:n.getPlayerId()),this.log("version",this.options.v)};function v(t,n,i){if(!t)return i;for(var o,a=t,r=e(Array.isArray(n)?n:n.split("."));!(o=r()).done;){var s=o.value;if(void 0===a[s])return i;a=a[s]}return a}function h(){return void 0!==document.visibilityState?Number("visible"===document.visibilityState):void 0!==document.hidden?Number(!document.hidden):void 0}function m(t,e){var n=e,i=e.parent,o={left:0,right:0,top:0,bottom:0};if(t){var a=t.getBoundingClientRect();n!==i&&(o=m(n.frameElement,i)),o={left:a.left+o.left,right:a.right+o.left,top:a.top+o.top,bottom:a.bottom+o.top}}return o}function w(t){var e=1/0,n=1/0;return!isNaN(t.document.body.clientWidth)&&t.document.body.clientWidth>0&&(e=t.document.body.clientWidth),!isNaN(t.document.body.clientHeight)&&t.document.body.clientHeight>0&&(n=t.document.body.clientHeight),t.document.documentElement&&t.document.documentElement.clientWidth&&!isNaN(t.document.documentElement.clientWidth)&&(e=t.document.documentElement.clientWidth),t.document.documentElement&&t.document.documentElement.clientHeight&&!isNaN(t.document.documentElement.clientHeight)&&(n=t.document.documentElement.clientHeight),t.innerWidth&&!isNaN(t.innerWidth)&&(e=Math.min(e,t.innerWidth)),t.innerHeight&&!isNaN(t.innerHeight)&&(n=Math.min(n,t.innerHeight)),[e,n]}function b(t){if(t)try{return new URL(t).hostname}catch(t){}}var A="afs_ads",E=["loaded","start","impression","firstQuartile","midpoint","thirdQuartile","complete","adError","log","click","volumeChange","mute","unmute"],k=function(t){var e,n;function i(e,n){var i;if(void 0===n&&(n={}),(i=t.call(this)||this).player=void 0,i.options=void 0,i.sessionFlags={likelyBreak:0,likelyBreakPos:0},i.log=function(){},i.utils=void 0,i.SHORT_NAME="bm-ima",i._getAdDetails=function(t){if(t)return{adId:t.getAdId(),adSys:t.getAdSystem(),adAN:t.getAdvertiserName(),adDID:t.getDealId(),adWId:t.getWrapperAdIds(),adWSys:t.getWrapperAdSystems(),adMU:t.getMediaUrl(),adCId:t.getCreativeId(),adWCId:t.getWrapperCreativeIds()}},i._getAdPod=function(t){var e={adMgV:i.getAdMgV()};return t&&("pre"===t?i.sessionFlags.likelyBreak=0:"post"===t?i.sessionFlags.likelyBreak=-1:i.sessionFlags.likelyBreak||(i.sessionFlags.likelyBreak=1)),e.adBreak=i.sessionFlags.likelyBreak,e.adBreakPos=i.sessionFlags.likelyBreakPos,e.adGid=i.utils.sessionId+"-"+e.adBreak+"-"+e.adBreakPos,e},i._adError=function(t){var e={type:"error"};return t&&("string"==typeof t?e.err=t:(e.st=null==t||null==t.getType?void 0:t.getType(),e.err=null==t||null==t.getVastErrorCode?void 0:t.getVastErrorCode(),e.err2=null==t||null==t.getErrorCode?void 0:t.getErrorCode())),Object.assign(e,i._getAdPod()),i.sessionFlags.likelyBreak++,i.sessionFlags.likelyBreakPos=0,e},i.PLAYER_EVENTS={sourceloaded:function(){return i.sessionFlags.resetOnInit&&i.resetState(),i.sessionFlags.resetOnInit=!0,{type:"init",aBl:i.getAdBlock()}},playbackfinished:function(){i.resetState()},admanifestloaded:function(t){var e,n;i.log("-------===========-----------==========admanifestloaded",t);var o={type:"serve",adURL:null==t||null==(e=t.adConfig)||null==(n=e.tag)?void 0:n.url,adMgV:i.getAdMgV()};return t.adBreak&&"vastandvmap"!==t.adBreak.passthroughMode&&("pre"===t.adConfig.position?i.sessionFlags.likelyBreak=0:"post"===t.adConfig.position&&(i.sessionFlags.likelyBreak=-1),Object.assign(o,i._getAdPod(null,!0))),o},aderror:function(t){var e,n,o,a,r,s={type:"error",st:"bm",err:String(t.code),adURL:null==t||null==(e=t.data)||null==(n=e.adConfig)||null==(o=n.tag)?void 0:o.url},l=t.data.code;return l&&(s.err2=String(l)),Object.assign(s,i._getAdPod(null==t||null==(a=t.data)||null==(r=a.adConfig)?void 0:r.position)),s},play:function(){if(!i.sessionFlags.play){var t,e;i.sessionFlags.play=!0;var n={type:"play",autoplay:!1};return(null==(t=i.player.getConfig())||null==(e=t.playback)?void 0:e.autoplay)&&(n.autoplay=i.player.getConfig().playback.autoplay),n}},playing:function(){var t,e;if(!0===(null==(t=i.player.getConfig())||null==(e=t.playback)?void 0:e.autoplay)&&!i.sessionFlags.play)return i.sessionFlags.play=!0,{type:"play",autoplay:!0}},timechanged:function(t){if("advertising-api"!==t.issuer){if(!i.sessionFlags.c0)return i.sessionFlags.c0=!0,{type:"c0"};var e=Math.floor(100*i.player.getCurrentTime()/i.player.getDuration());return!i.sessionFlags.c95&&e>=95?(i.sessionFlags.c95=!0,i.sessionFlags.c75=!0,i.sessionFlags.c50=!0,i.sessionFlags.c25=!0,{type:"c95"}):!i.sessionFlags.c75&&e>=75?(i.sessionFlags.c75=!0,i.sessionFlags.c50=!0,i.sessionFlags.c25=!0,{type:"c75"}):!i.sessionFlags.c50&&e>=50?(i.sessionFlags.c50=!0,i.sessionFlags.c25=!0,{type:"c50"}):!i.sessionFlags.c25&&e>=25?(i.sessionFlags.c25=!0,{type:"c25"}):void 0}},"wtat-loaded":function(t){var e={type:"al"},n=t.detail.getAd();return Object.assign(e,i._getAdPod(n)),e},"wtat-start":function(t){var e={type:"sa"},n=t.detail.getAd();return Object.assign(e,i._getAdDetails(n)),Object.assign(e,i._getAdPod(n)),e},"wtat-impression":function(t){var e={type:"imp"},n=t.detail.getAd();return Object.assign(e,i._getAdPod(n)),e},"wtat-firstQuartile":function(t){var e={type:"efq"},n=t.detail.getAd();return Object.assign(e,i._getAdPod(n)),e},"wtat-midpoint":function(t){var e={type:"esq"},n=t.detail.getAd();return Object.assign(e,i._getAdPod(n)),e},"wtat-thirdQuartile":function(t){var e={type:"etq"},n=t.detail.getAd();return Object.assign(e,i._getAdPod(n)),e},"wtat-complete":function(t){var e={type:"ecp"},n=t.detail.getAd();Object.assign(e,i._getAdPod(n));var o=null==n||null==n.getAdPodInfo?void 0:n.getAdPodInfo();return o&&(o.getAdPosition()<o.getTotalAds()?i.sessionFlags.likelyBreakPos++:(i.sessionFlags.likelyBreak++,i.sessionFlags.likelyBreakPos=0)),e},"wtat-mute":function(t){var e={type:"mute"},n=t.detail.getAd();return Object.assign(e,i._getAdPod(n)),e},"wtat-unmute":function(t){var e={type:"unmute"},n=t.detail.getAd();return Object.assign(e,i._getAdPod(n)),e},"wtat-click":function(t){var e={type:"adClick"},n=t.detail.getAd();return Object.assign(e,i._getAdPod(n)),e},"wtat-adError":function(t){return{type:"wtat-adError",debug:JSON.stringify(Object.keys(t.originalEvent))}},"wtat-log":function(t){var e,n;return i._adError(null==(e=t.detail)||null==e.getAdData||null==(n=e.getAdData())?void 0:n.adError)}},i.start=function(){i.utils=new f(i.options,function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(i)),i.log=i.utils.logger("WTAT."+i.SHORT_NAME),i.resetState(),i._honeyPot(),Object.assign(i.PLAYER_EVENTS,v(window,["wtatCustom","events"],{}),i.PLAYER_EVENTS),Object.keys(i.PLAYER_EVENTS).forEach((function(t){i.player.on(t,i._onPlayerEvent),i.player.getContainer().addEventListener(t,i._onPlayerEvent)}))},i.resetState=function(){i.log("resetting state"),i.sessionFlags={likelyBreak:0,likelyBreakPos:0},i.utils.createSession()},i.setAdManager=function(t){E.forEach((function(e){t.addEventListener(e,i._forwardAdManagerEvent)}))},i._forwardAdManagerEvent=function(t){i.player.getContainer().dispatchEvent(new CustomEvent("wtat-"+t.type,{detail:t}))},i._onPlayerEvent=function(t){if(i.PLAYER_EVENTS[t.type]){var e;if("function"==typeof i.PLAYER_EVENTS[t.type])try{e=i.PLAYER_EVENTS[t.type](t)}catch(e){i.log("Error executing event listener for",t.type,e.message)}else e=!0===i.PLAYER_EVENTS[t.type]?{type:t.type}:i.PLAYER_EVENTS[t.type];e&&(e.type?i.utils.sendData(e):i.log("Encountered an event without a type. Not sending",t.type,e))}else i.log("Untracked player event triggered",t.type,t)},i._honeyPot=function(){var t=document.createElement("div");t.className=A,t.innerHTML="&nbsp;",t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.background="transparent";try{document.body.appendChild(t),i.sessionFlags.honeyPotOk=!0,i.log("ad blocker honeypot installed")}catch(t){i.log("cannot attach honeypot",t.message)}},i.getVideoSlot=function(){return i.player.getContainer()},i.getMediaId=function(){var t,e;return null==(t=i.player.getConfig())||null==(e=t.analytics)?void 0:e.videoId},i.getPlayerId=function(){var t,e=null==(t=i.player.getConfig())?void 0:t.analytics;return(null==e?void 0:e.playerKey)||(null==e?void 0:e.player)||(null==e?void 0:e.key)},i.getPlayerVersion=function(){return i.player.version},i.getAdBlock=function(){if(!i.sessionFlags.honeyPotOk)return-1;try{var t=document.body.getElementsByClassName(A),e=t[t.length-1];return e&&null!==e.offsetParent&&e.className===A&&0!==e.innerHTML.length&&0!==e.clientHeight?0:1}catch(t){return i.log("error getting ad block status",t.message),-2}},i.getAdMgV=function(){var t,e;return null==(t=google)||null==(e=t.ima)?void 0:e.VERSION},i.getIsLive=function(){return Number(i.player.isLive())},i.player=e,i.options=n,i.options.src=i.SHORT_NAME,"debug"===i.options.debug)debugger;return i}return n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n,i}(i),I="5.2.0",P={v:I},C={};try{var F=localStorage.getItem("wtDebug"),S=localStorage.getItem("wtUrl");F&&(C.debug=F),S&&(C.wtUrl=S)}catch(t){}return function(t,e){if(void 0===t&&(t={}),e)if(e.getSource())console.error("Watching That plugin must be instantiated before calling player.load()");else{var n=Object.assign({},P,t,C);n.wtatCustom&&(window.wtatCustom=window.wtatCustom||{},n.wtatCustom.fields&&(window.wtatCustom.fields=Object.assign({},window.wtatCustom.fields||{},n.wtatCustom.fields)),n.wtatCustom.events&&(window.wtatCustom.events=Object.assign({},window.wtatCustom.events||{},n.wtatCustom.events)),n.wtatCustom.ignoredEvents&&(window.wtatCustom.ignoredEvents=[].concat(window.wtatCustom.ignoredEvents||[],n.wtatCustom.ignoredEvents)),delete n.wtatCustom),e.wtAdTracer=new k(e,n),e.wtAdTracer.version=I,e.wtAdTracer.start()}else console.error("Watching That plugin missing player instance. Consult documentation for proper initialisation parameters!")}}();
