var wtAdTracer=function(){"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function t(t,n){var a;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(a=function(t,n){if(t){if("string"==typeof t)return e(t,n);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?e(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){a&&(t=a);var o=0;return function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(a=t[Symbol.iterator]()).next.bind(a)}var n,a=function(){function e(){this.player=void 0,this.utils=void 0,this.SHORT_NAME="Must be implemented",this.PLAYER_EVENTS={}}var t=e.prototype;return t.start=function(){},t.getVideoSlot=function(){},t.getMediaId=function(){},t.getPlayerId=function(){},t.getPlayerVersion=function(){},t.getAdBlock=function(){},t.getAdMgV=function(){},t.getIdx=function(){},t.getPercentViewable=function(){},t.getIsLive=function(){},e}(),o={endpoint:"https://c.p2r14.com/v5/in",batchSize:5,batchInterval:1e3,debug:!1},s={0:[]},i=0,r=!1,l=!1,d=function(){if(o.debug)try{for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.warn.apply(null,["%cWTAT.stream","background:#ffd400;color:#000;padding:2px"].concat(t))}catch(e){}};function u(){o.batchInterval>0&&(n=setInterval(g,o.batchInterval))}function c(){clearInterval(n)}function g(){if(!r){r=!0,c();var e=i;s[i+1]=[],i++,s[e].length&&function(e,t){d("sending",e);try{var n=JSON.stringify(e);if(navigator.sendBeacon){var a=new FormData;a.append("batch",n),a.append("apiKey",o.apiKey),navigator.sendBeacon(o.endpoint,a)||d("beacon queue error"),p(t)}else{var s=new XMLHttpRequest;s.open("POST",o.endpoint,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.setRequestHeader("x-api-key",o.apiKey),s.setRequestHeader("Connection","keep-alive"),s.onreadystatechange=function(){p(t)},s.send("batch="+encodeURIComponent(n))}}catch(e){d("xhr error",e.message)}}(s[e],e),r=!1,u()}}function p(e){delete s[e]}var y=function(){function e(e){void 0===e&&(e={}),o=Object.assign(o,e),u()}var t=e.prototype;return t.push=function(e){!l&&e&&(d("received",e),s[i].push(e),s[i].length>=o.batchSize&&g())},t.stop=function(){l=!0,s[i].length&&g(),c()},e}(),v=function(e,t){var n,a=this;this.options={debug:!1,sendAllCustom:!1},this.sessionId=void 0,this.loopIdx=0,this.staticData={},this.sessionFlags={},this.env={},this.stream=void 0,this.createGuid=function(){for(var e="",t=0;t<12;t++)e+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXZY01234567890".charAt(Math.floor(64*Math.random()));return Date.now()+"-"+e},this.createSession=function(){var e,t,n=!1;try{n=!!window.top.innerWidth||!!window.top.document.documentElement.clientWidth||!!window.top.document.body.clientWidth}catch(e){}a.sessionFlags={firstTimeDataSent:!1,isFif:n,sessionStartTime:Date.now()},a.sessionId=a.createGuid(),0===a.loopIdx&&(a.playlistId=a.createGuid()),a.loopIdx+=1;var o=function(){var e,t;try{var n=w(window.top);e=n[0],t=n[1]}catch(e){}if(!e){var a=window,o=w(a);e=o[0],t=o[1];try{for(;a.parent&&a!==a.parent;){var s=w(a.parent);e=s[0],t=s[1],a=a.parent}}catch(e){}}return[e,t]}();return a.sessionFlags.ww=o[0],a.sessionFlags.wh=o[1],a.sessionFlags.pu=function(e){var t=document.referrer;!t&&e&&(t=document.documentURI);try{var n,a;(window.location===window.parent.location||!t&&(null==(n=document)||null==(a=n.location)?void 0:a.href))&&(t=document.location.href)}catch(e){}return t}(n),a.staticData={rid:a.sessionId,idx:(null==(e=a.env)||null==e.getIdx?void 0:e.getIdx())||a.loopIdx,plGid:a.playlistId,src:a.options.src,v:a.options.v,plV:null==(t=a.env)||null==t.getPlayerVersion?void 0:t.getPlayerVersion(),fif:+a.sessionFlags.isFif,domain:b(a.sessionFlags.pu)},a.sessionId},this.sendData=function(e){a.stream.push(a.gatherData(e))},this.gatherData=function(e){var t,n,o;void 0===e&&(e={});var s,i=Object.assign({},e,a.staticData,{mediaId:null==(t=a.env)||null==t.getMediaId?void 0:t.getMediaId(),playerId:null==(n=a.env)||null==n.getPlayerId?void 0:n.getPlayerId(),cst:Date.now()-a.sessionFlags.sessionStartTime,pVisible:m(),isLive:null==(o=a.env)||null==o.getIsLive?void 0:o.getIsLive()});a.sessionFlags.firstTimeDataSent||(a.sessionFlags.firstTimeDataSent=!0,i.cst=0,i.ww=a.sessionFlags.ww,i.wh=a.sessionFlags.wh,i.pu=a.sessionFlags.pu);try{var r=a.env.getVideoSlot();if(r){var l,d;i.per=null!=(l=null==(d=a.env)||null==d.getPercentViewable?void 0:d.getPercentViewable())?l:function(e,t){if(!e)return;try{var n=window.getComputedStyle(e,null),a=n.getPropertyValue("visibility"),o=n.getPropertyValue("display");if("hidden"===a||"none"===o)return 0;try{if(t){var s=w(window.top),i=s[0],r=s[1],l=e.getBoundingClientRect(),d=0,u=0;if(i===1/0||r===1/0)return;var c=h(e,window);try{d=c.bottom<0||c.top>r?0:c.top<r&&c.bottom>r?(r-c.top)/l.height*100:c.top<0&&c.bottom>0?c.bottom/l.height*100:100,u=c.right<0||c.left>i?0:c.right<i&&c.left>i?(i-c.right)/l.width*100:c.left<0&&c.right>0?c.right/l.width*100:100}catch(e){return}return parseInt(u*d/100,10)}}catch(e){}}catch(e){}}(r,a.sessionFlags.isFif);var u=r.getBoundingClientRect();i.w=parseInt(u.width,10),i.h=parseInt(u.height,10)}}catch(e){a.log("gatherData ERROR reading ad WxH:",e.message)}try{var c=f(window,["wtatCustom","fields"],{});Object.keys(c).length&&(i.custom=i.custom||{},Object.entries(c).forEach((function(e){var t=e[0],n=e[1];"function"==typeof n?i.custom[t]=n(i):!a.options.sendAllCustom&&a.sessionFlags.staticCustomSent||(i.custom[t]=n)}))),a.sessionFlags.staticCustomSent=!0}catch(e){a.log("gatherData error",e.message)}if(s=i,!f(window,["wtatCustom","ignoredEvents"],[]).some((function(e){return Object.entries(e).every((function(e){var t=e[0],n=e[1];return f(s,t)===n}))})))return i},this.logger=function(e){return function(){if(a.options.debug)try{for(var t,n,o=arguments.length,s=new Array(o),i=0;i<o;i++)s[i]=arguments[i];console.warn.apply(null,["%c"+e+" "+(null!=(t=null==(n=a.env)||null==n.getPlayerId?void 0:n.getPlayerId())?t:""),"background:#ffd400;color:#000;padding:2px"].concat(s))}catch(e){}}},this.options=Object.assign(this.options,e),this.env=t;var o={debug:this.options.debug,apiKey:this.options.apiKey};this.options.wtUrl&&(o.endpoint=this.options.wtUrl),window&&window.wtStream?this.stream=window.wtStream:(this.stream=new y(o),window&&(window.wtStream=this.stream)),this.log=this.logger("WTAT.core",this.options.debug,null==(n=this.env)||null==n.getPlayerId?void 0:n.getPlayerId()),this.log("version",this.options.v)};function f(e,n,a){if(!e)return a;for(var o,s=e,i=t(Array.isArray(n)?n:n.split("."));!(o=i()).done;){var r=o.value;if(void 0===s[r])return a;s=s[r]}return s}function m(){return void 0!==document.visibilityState?Number("visible"===document.visibilityState):void 0!==document.hidden?Number(!document.hidden):void 0}function h(e,t){var n=t,a=t.parent,o={left:0,right:0,top:0,bottom:0};if(e){var s=e.getBoundingClientRect();n!==a&&(o=h(n.frameElement,a)),o={left:s.left+o.left,right:s.right+o.left,top:s.top+o.top,bottom:s.bottom+o.top}}return o}function w(e){var t=1/0,n=1/0;return!isNaN(e.document.body.clientWidth)&&e.document.body.clientWidth>0&&(t=e.document.body.clientWidth),!isNaN(e.document.body.clientHeight)&&e.document.body.clientHeight>0&&(n=e.document.body.clientHeight),e.document.documentElement&&e.document.documentElement.clientWidth&&!isNaN(e.document.documentElement.clientWidth)&&(t=e.document.documentElement.clientWidth),e.document.documentElement&&e.document.documentElement.clientHeight&&!isNaN(e.document.documentElement.clientHeight)&&(n=e.document.documentElement.clientHeight),e.innerWidth&&!isNaN(e.innerWidth)&&(t=Math.min(t,e.innerWidth)),e.innerHeight&&!isNaN(e.innerHeight)&&(n=Math.min(n,e.innerHeight)),[t,n]}function b(e){if(e)try{return new URL(e).hostname}catch(e){}}var k="afs_ads",F=function(e){var t,n;function a(t,n){var a;if(void 0===n&&(n={}),(a=e.call(this)||this).player=void 0,a.options=void 0,a.sessionFlags={likelyBreak:0,likelyBreakPos:0},a.log=function(){},a.utils=void 0,a.SHORT_NAME="akp",a._getAdDetails=function(e){if(e)return{adId:e.getAdId(),adSys:e.getAdSystem(),adAN:e.getAdvertiserName(),adDID:e.getDealId(),adWId:e.getWrapperAdIds(),adWSys:e.getWrapperAdSystems(),adMU:e.getMediaUrl(),adCId:e.getCreativeId(),adWCId:e.getWrapperCreativeIds()}},a._getAdPod=function(e,t){void 0===t&&(t=!1);var n={adMgV:a.getAdMgV()},o=null==e||null==e.getAdPodInfo?void 0:e.getAdPodInfo();if(o){try{var s;n.adBreak=null!=(s=null==o||null==o.getPodIndex?void 0:o.getPodIndex())?s:0,a.sessionFlags.likelyBreak=n.adBreak}catch(e){n.adBreak=t?a.sessionFlags.likelyBreak:0}try{var i;n.adBreakPos=(null!=(i=null==o||null==o.getAdPosition?void 0:o.getAdPosition())?i:1)-1,a.sessionFlags.likelyBreakPos=n.adBreakPos}catch(e){n.adBreakPos=t?a.sessionFlags.likelyBreakPos:0}n.adGid=a.utils.sessionId+"-"+n.adBreak+"-"+n.adBreakPos;try{var r=null==o||null==o.getTotalAds?void 0:o.getTotalAds();a.sessionFlags.totalAds||(a.sessionFlags.totalAds={}),a.sessionFlags.totalAds[n.adBreak]=r}catch(e){}}else t&&(n.adBreak=a.sessionFlags.likelyBreak,n.adBreakPos=a.sessionFlags.likelyBreakPos,n.adGid=a.utils.sessionId+"-"+n.adBreak+"-"+n.adBreakPos);return n},a._adError=function(e,t){var n,o,s={type:"error"};e&&("string"==typeof e?s.err=e:(s.st=null==e||null==e.getType?void 0:e.getType(),s.err=null==e||null==e.getVastErrorCode?void 0:e.getVastErrorCode(),s.err2=null==e||null==e.getErrorCode?void 0:e.getErrorCode(),Object.assign(s,a._getAdPod(t,!0)),(null==(n=a.sessionFlags)||null==(o=n.totalAds)?void 0:o[a.sessionFlags.likelyBreak])?a.sessionFlags.likelyBreakPos<a.sessionFlags.totalAds[a.sessionFlags.likelyBreak]-1?a.sessionFlags.likelyBreakPos++:(a.sessionFlags.likelyBreak++,a.sessionFlags.likelyBreakPos=0):a.sessionFlags.likelyBreakPos++));return s},a.PLAYER_EVENTS={mediasequenceinitialized:function(){return a.sessionFlags.resetOnInit&&a.resetState(),a.sessionFlags.resetOnInit=!0,{type:"init",aBl:a.getAdBlock()}},mediasequenceended:function(){a.resetState()},admanagerloaded:function(e){e.data.adManager.addEventListener("log",(function(e){a.player.dispatch("wtat-log",{originalEvent:e})}))},adrequest:function(e){var t,n,o,s;return{type:"serve",adURL:(null==e||null==(t=e.detail)||null==(n=t.adsRequest)?void 0:n.adTagUrl)||(null==(o=a.player.ads)||null==(s=o.proxy)?void 0:s.adTagUrl),adMgV:a.getAdMgV()}},adbreakstart:function(){var e;a.sessionFlags.likelyBreak>0&&!(null==(e=a.sessionFlags.podEndedRanFor)?void 0:e.includes(a.sessionFlags.likelyBreak-1))&&a.sessionFlags.likelyBreak++,a.sessionFlags.likelyBreakPos=0},adbreakend:function(e){var t,n;a.sessionFlags.podEndedRanFor||(a.sessionFlags.podEndedRanFor=[]),a.sessionFlags.podEndedRanFor.push(a.sessionFlags.likelyBreak);var o=null==e||null==(t=e.data)||null==(n=t.metadata)||null==n.getAdPodInfo?void 0:n.getAdPodInfo();if(o)try{a.sessionFlags.likelyBreak=o.getPodIndex()+1}catch(e){a.sessionFlags.likelyBreak++}else a.sessionFlags.likelyBreak++;a.sessionFlags.likelyBreakPos=0},adloaded:function(e){var t,n={type:"al"},o=null==e||null==(t=e.data)?void 0:t.metadata;return Object.assign(n,a._getAdDetails(o)),Object.assign(n,a._getAdPod(o)),n},adimpression:function(e){var t,n={type:"imp"},o=null==e||null==(t=e.data)?void 0:t.metadata;return Object.assign(n,a._getAdDetails(o)),Object.assign(n,a._getAdPod(o)),n},adstarted:function(e){var t,n={type:"sa"},o=null==e||null==(t=e.data)?void 0:t.metadata;return Object.assign(n,a._getAdPod(o)),n},adfirstquartile:function(e){var t,n={type:"efq"},o=null==e||null==(t=e.data)?void 0:t.metadata;return Object.assign(n,a._getAdPod(o)),n},admidpoint:function(e){var t,n={type:"esq"},o=null==e||null==(t=e.data)?void 0:t.metadata;return Object.assign(n,a._getAdPod(o)),n},adthirdquartile:function(e){var t,n={type:"etq"},o=null==e||null==(t=e.data)?void 0:t.metadata;return Object.assign(n,a._getAdPod(o)),n},adended:function(e){var t,n={type:"ecp"},o=null==e||null==(t=e.data)?void 0:t.metadata;return Object.assign(n,a._getAdPod(o)),a.sessionFlags.likelyBreakPos++,n},adadclicked:function(e){var t,n={type:"adClick"},o=null==e||null==(t=e.data)?void 0:t.metadata;return Object.assign(n,a._getAdPod(o)),n},"wtat-log":function(e){var t,n;return a._adError(null==(t=e.data.originalEvent)||null==t.getAdData||null==(n=t.getAdData())?void 0:n.adError,e.data.originalEvent.getAd())},aderror:function(e){var t,n;return a._adError(null==e||null==(t=e.data)?void 0:t.error,null==e||null==(n=e.data)?void 0:n.metadata)},play:function(){if(!a.sessionFlags.play)return a.sessionFlags.play=!0,{type:"play",autoplay:a.getAutoplay()}},playing:function(){if(!a.sessionFlags.c0)return a.sessionFlags.c0=!0,{type:"c0",autoplay:a.getAutoplay()}},mutechange:function(e){var t,n,o,s={type:e.data?"mute":"unmute"},i=null==e||null==(t=e.target)||null==(n=t.ads)||null==(o=n.currentAd)?void 0:o.metadata;return Object.assign(s,a._getAdPod(i)),s},timeupdate:function(e){if(a.sessionFlags.c0){var t=Math.floor(100*e.data/e.player.absoluteDuration);if(!a.sessionFlags.c95&&t>=95)return a.sessionFlags.c95=!0,a.sessionFlags.c75=!0,a.sessionFlags.c50=!0,a.sessionFlags.c25=!0,{type:"c95"};if(!a.sessionFlags.c75&&t>=75)return a.sessionFlags.c75=!0,a.sessionFlags.c50=!0,a.sessionFlags.c25=!0,{type:"c75"};if(!a.sessionFlags.c50&&t>=50)return a.sessionFlags.c50=!0,a.sessionFlags.c25=!0,{type:"c50"};if(!a.sessionFlags.c25&&t>=25)return a.sessionFlags.c25=!0,{type:"c25"}}}},a.start=function(){a.utils=new v(a.options,function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(a)),a.log=a.utils.logger("WTAT."+a.SHORT_NAME),a.resetState(),a._honeyPot(),Object.assign(a.PLAYER_EVENTS,f(window,["wtatCustom","events"],{}),a.PLAYER_EVENTS),Object.keys(a.PLAYER_EVENTS).forEach((function(e){a.player.on(e,a._onPlayerEvent)}))},a.resetState=function(){a.log("resetting state"),a.sessionFlags={likelyBreak:0,likelyBreakPos:0},a.utils.createSession()},a._onPlayerEvent=function(e){if(a.PLAYER_EVENTS[e.type]){var t;if("function"==typeof a.PLAYER_EVENTS[e.type])try{t=a.PLAYER_EVENTS[e.type](e)}catch(t){a.log("Error executing event listener for",e.type,t.message)}else t=!0===a.PLAYER_EVENTS[e.type]?{type:e.type}:a.PLAYER_EVENTS[e.type];t&&(t.type?a.utils.sendData(t):a.log("Encountered an event without a type. Not sending",e.type,t))}else a.log("Untracked player event triggered",e.type,e)},a._honeyPot=function(){var e=document.createElement("div");e.className=k,e.innerHTML="&nbsp;",e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.background="transparent";try{document.body.appendChild(e),a.sessionFlags.honeyPotOk=!0,a.log("ad blocker honeypot installed")}catch(e){a.log("cannot attach honeypot",e.message)}},a.getVideoSlot=function(){return a.player.mediaElement},a.getMediaId=function(){var e,t;return null==(e=a.player)||null==(t=e.media)?void 0:t.guid},a.getPlayerVersion=function(){return a.player.version},a.getAdBlock=function(){if(!a.sessionFlags.honeyPotOk)return-1;try{var e=document.body.getElementsByClassName(k),t=e[e.length-1];return t&&null!==t.offsetParent&&t.className===k&&0!==t.innerHTML.length&&0!==t.clientHeight?0:1}catch(e){return a.log("error getting ad block status",e.message),-2}},a.getAutoplay=function(){return a.player.autoplay&&!a.player.autoplayblocked},a.getAdMgV=function(){var e,t;return null==(e=google)||null==(t=e.ima)?void 0:t.VERSION},a.getIsLive=function(){return Number(a.player.isLive)},a.player=t,a.options=n,a.options.src=a.SHORT_NAME,"debug"===a.options.debug)debugger;return a}return n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,a}(a),A="5.3.0",E={v:A},P={};try{var I=localStorage.getItem("wtDebug"),S=localStorage.getItem("wtUrl");I&&(P.debug=I),S&&(P.wtUrl=S)}catch(e){}function B(e,t){var n=t.config,a=void 0===n?{}:n,o=Object.assign({},E,a,P);return o.wtatCustom&&(window.wtatCustom=window.wtatCustom||{},o.wtatCustom.fields&&(window.wtatCustom.fields=Object.assign({},window.wtatCustom.fields||{},o.wtatCustom.fields)),o.wtatCustom.events&&(window.wtatCustom.events=Object.assign({},window.wtatCustom.events||{},o.wtatCustom.events)),o.wtatCustom.ignoredEvents&&(window.wtatCustom.ignoredEvents=[].concat(window.wtatCustom.ignoredEvents||[],o.wtatCustom.ignoredEvents)),delete o.wtatCustom),new F(e,o).start(),Promise.resolve({})}return akamai.amp.AMP.registerPlugin("wtAdTracer",B),B.VERSION=A,B}();
