var wtAdTracer=function(){"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function t(t,i){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,i){if(t){if("string"==typeof t)return e(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,i):void 0}}(t))||i&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=t[Symbol.iterator]()).next.bind(n)}var i,n={endpoint:"https://c.p2r14.com/v5/in",batchSize:5,batchInterval:1e3,debug:!1},r={0:[]},a=0,o=!1,s=!1,l=function(){if(n.debug)try{for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];console.warn.apply(null,["%cWTAT.stream","background:#ffd400;color:#000;padding:2px"].concat(t))}catch(e){}};function d(){n.batchInterval>0&&(i=setInterval(u,n.batchInterval))}function c(){clearInterval(i)}function u(){if(!o){o=!0,c();var e=a;r[a+1]=[],a++,r[e].length&&function(e,t){l("sending",e);try{var i=JSON.stringify(e);if(navigator.sendBeacon){var r=new FormData;r.append("batch",i),r.append("apiKey",n.apiKey),navigator.sendBeacon(n.endpoint,r)||l("beacon queue error"),g(t)}else{var a=new XMLHttpRequest;a.open("POST",n.endpoint,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.setRequestHeader("x-api-key",n.apiKey),a.setRequestHeader("Connection","keep-alive"),a.onreadystatechange=function(){g(t)},a.send("batch="+encodeURIComponent(i))}}catch(e){l("xhr error",e.message)}}(r[e],e),o=!1,d()}}function g(e){delete r[e]}var h=function(){function e(e){void 0===e&&(e={}),n=Object.assign(n,e),d()}var t=e.prototype;return t.push=function(e){!s&&e&&(l("received",e),r[a].push(e),r[a].length>=n.batchSize&&u())},t.stop=function(){s=!0,r[a].length&&u(),c()},e}();var p=function(e,t){var i,n=this;void 0===t&&(t={}),this.options={debug:!1,sendAllCustom:!1},this.sessionId=void 0,this.sessionStartTime=0,this.loopIdx=0,this.requiredData={},this.firstTimeData=null,this.firstTimeDataSent=!1,this.env={},this.stream=void 0,this.createGuid=function(){for(var e="",t=0;t<12;t++)e+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXZY01234567890".charAt(Math.floor(64*Math.random()));return Date.now()+"-"+e},this.createSession=function(){return n.sessionId=n.createGuid(),n.sessionStartTime=Date.now(),0===n.loopIdx&&(n.playlistId=n.createGuid()),n.loopIdx+=1,n.requiredData={rid:n.sessionId,idx:n.loopIdx,plGid:n.playlistId},n.firstTimeData=n.gatherFirstTimeData(),n.firstTimeDataSent=!1,n.sessionId},this.gatherFirstTimeData=function(){var e,t,i=n.getWindowWH(),r=i[0],a=i[1],o=i[2],s={type:"init",src:n.options.src,v:n.options.v,aBl:null!=(e=null==n.env.getAdBlock?void 0:n.env.getAdBlock())?e:-1,ww:r,wh:a,fif:o,pu:n.getPU(o),plV:null==(t=n.env)||null==t.getPlayerVersion?void 0:t.getPlayerVersion()};try{var l=y(window,["wtatCustom","fields"],{});Object.keys(l).length&&(s.custom=s.custom||{},Object.entries(l).forEach((function(e){var t=e[0],i=e[1];s.custom[t]="function"==typeof i?i(s):i})))}catch(e){n.log("gatherFirstTimeData error",e.message)}return s},this.sendData=function(e){n.firstTimeDataSent||(n.firstTimeDataSent=!0,n.stream.push(n.gatherData(n.firstTimeData,0))),n.stream.push(n.gatherData(e))},this.gatherData=function(e,t){var i,r;void 0===e&&(e={});var a,o=Object.assign({},e,n.requiredData,{mediaId:null==(i=n.env)||null==i.getMediaId?void 0:i.getMediaId(),playerId:null==(r=n.env)||null==r.getPlayerId?void 0:r.getPlayerId(),cst:void 0!==t?t:Date.now()-(n.sessionStartTime||0)});void 0!==document.visibilityState?o.pVisible=Number("visible"===document.visibilityState):void 0!==document.hidden&&(o.pVisible=Number(!document.hidden));try{var s=n.env.getVideoSlot();if(s){o.per=n.getVisiblePercent(s);var l=s.getBoundingClientRect();o.w=parseInt(l.width,10),o.h=parseInt(l.height,10)}}catch(e){n.log("gatherData ERROR reading ad WxH:",e.message)}try{var d=y(window,["wtatCustom","fields"],{});Object.keys(d).length&&(o.custom=o.custom||{},Object.entries(d).forEach((function(e){var t=e[0],i=e[1];"function"==typeof i?o.custom[t]=i(o):n.options.sendAllCustom&&(o.custom[t]=i)})))}catch(e){n.log("gatherData error",e.message)}if(a=o,!y(window,["wtatCustom","ignoredEvents"],[]).some((function(e){return Object.entries(e).every((function(e){var t=e[0],i=e[1];return y(a,t)===i}))})))return o},this.getPU=function(e){var t=document.referrer;!t&&e&&(t=document.documentURI);try{(window.location===window.parent.location||!t&&document.location&&document.location.href)&&(t=document.location.href)}catch(e){n.log("gatherData pu set to referrer:",t,e.message)}return t},this.getPositionRelativeToViewPort=function(e,t){var i=t,r=t.parent,a={left:0,right:0,top:0,bottom:0};if(e){var o=e.getBoundingClientRect();i!==r&&(a=n.getPositionRelativeToViewPort(i.frameElement,r)),a={left:o.left+a.left,right:o.right+a.left,top:o.top+a.top,bottom:o.bottom+a.top}}return a},this.getViewPortSize=function(e){var t={width:1/0,height:1/0,area:1/0};return!isNaN(e.document.body.clientWidth)&&e.document.body.clientWidth>0&&(t.width=e.document.body.clientWidth),!isNaN(e.document.body.clientHeight)&&e.document.body.clientHeight>0&&(t.height=e.document.body.clientHeight),e.document.documentElement&&e.document.documentElement.clientWidth&&!isNaN(e.document.documentElement.clientWidth)&&(t.width=e.document.documentElement.clientWidth),e.document.documentElement&&e.document.documentElement.clientHeight&&!isNaN(e.document.documentElement.clientHeight)&&(t.height=e.document.documentElement.clientHeight),e.innerWidth&&!isNaN(e.innerWidth)&&(t.width=Math.min(t.width,e.innerWidth)),e.innerHeight&&!isNaN(e.innerHeight)&&(t.height=Math.min(t.height,e.innerHeight)),t.area=t.height*t.width,t},this.getWindowWH=function(){var e,t=0,i=0,r=0;try{t=(e=n.getViewPortSize(window.top)).width,i=e.height,r=1}catch(e){n.log("getWindowWH catch 1:",e.message)}if(!t){var a=window;t=(e=n.getViewPortSize(a)).width,i=e.height;try{for(;a.parent&&a!==a.parent;)t=(e=n.getViewPortSize(a.parent)).width,i=e.height,a=a.parent}catch(e){n.log("getWindowWH catch 2:",e.message)}}return[t,i,r]},this.getSameDomainViewability=function(e){var t=n.getViewPortSize(window.top),i=e.getBoundingClientRect(),r=-1,a=-1;if(t.area===1/0)return{error:"Failed to determine viewport",horizontalPer:0,verticalPer:0};var o=n.getPositionRelativeToViewPort(e,window);try{r=o.bottom<0||o.top>t.height?0:o.top<t.height&&o.bottom>t.height?(t.height-o.top)/i.height*100:o.top<0&&o.bottom>0?o.bottom/i.height*100:100,a=o.right<0||o.left>t.width?0:o.right<t.width&&o.left>t.width?(t.width-o.right)/i.width*100:o.left<0&&o.right>0?o.right/i.width*100:100}catch(e){return{error:"Failed to calculate viewability: "+e.message,horizontalPer:0,verticalPer:0}}return{horizontalPer:a,verticalPer:r}},this.getVisiblePercent=function(e){if(!e)return-1;var t={percentObscured:0,percentViewable:0,acceptedViewablePercentage:50,viewabilityStatus:!1,duration:0,cssInvisible:!1,domObscured:!1,secureIFrame:!1};try{var i=e.getBoundingClientRect();i.width*i.height>=242500&&(t.acceptedViewablePercentage=30);var r=window.getComputedStyle(e,null),a=r.getPropertyValue("visibility"),o=r.getPropertyValue("display");if("hidden"!==a&&"none"!==o||(t.cssInvisible=!0),t.cssInvisible)return 0;t.percentObscured=t.percentObscured||0;var s={};try{window.top.innerWidth||window.top.document.documentElement.clientWidth||window.top.document.body.clientWidth?s=n.getSameDomainViewability(e):t.secureIFrame=!0}catch(e){t.secureIFrame=!0}return s.error||t.secureIFrame||(t.percentViewable=(s.verticalPer-t.percentObscured)*(s.horizontalPer-t.percentObscured)/100),t.percentViewable?parseInt(t.percentViewable,10):0}catch(e){return n.log("getVisiblePercent error",e.message),-2}},this.logger=function(e){return function(){if(n.options.debug)try{for(var t,i,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];console.warn.apply(null,["%c"+e+" "+(null!=(t=null==(i=n.env)||null==i.getPlayerId?void 0:i.getPlayerId())?t:""),"background:#ffd400;color:#000;padding:2px"].concat(a))}catch(e){}}},this.options=Object.assign(this.options,e),this.env=t;var r={debug:this.options.debug,apiKey:this.options.apiKey};this.options.wtUrl&&(r.endpoint=this.options.wtUrl),window&&window.wtStream?this.stream=window.wtStream:(this.stream=new h(r),window&&(window.wtStream=this.stream)),this.log=this.logger("WTAT.core",this.options.debug,null==(i=this.env)||null==i.getPlayerId?void 0:i.getPlayerId()),this.log("version",this.options.v),this.createSession()};function y(e,i,n){if(!e)return n;for(var r,a=e,o=t(Array.isArray(i)?i:i.split("."));!(r=o()).done;){var s=r.value;if(void 0===a[s])return n;a=a[s]}return a}var v,m,f="afs_ads",w={0:"PREROLL","-1":"POSTROLL"},b="5.0.2",P=((m={modules:(v={},v.wtatBCIma=function(e,t){var i=this;if(void 0===t&&(t={}),this.player=void 0,this.options=void 0,this.sessionFlags={likelyBreak:0,likelyBreakPos:0},this.resetOnLoadStart=!1,this.log=function(){},this.utils=void 0,this.SHORT_NAME="bcp",this._getAdDetails=function(e){if(e)return{adId:e.getAdId(),adSys:e.getAdSystem(),adAN:e.getAdvertiserName(),adDID:e.getDealId(),adWId:e.getWrapperAdIds(),adWSys:e.getWrapperAdSystems(),adMU:e.getMediaUrl(),adCId:e.getCreativeId(),adWCId:e.getWrapperCreativeIds()}},this._getAdPod=function(e,t){void 0===t&&(t=!1);var n={},r=null==e||null==e.getAdPodInfo?void 0:e.getAdPodInfo();if(r){try{var a;n.adBreak=null!=(a=null==r||null==r.getPodIndex?void 0:r.getPodIndex())?a:0,i.sessionFlags.likelyBreak=n.adBreak}catch(e){n.adBreak=t?i.sessionFlags.likelyBreak:0}try{var o;n.adBreakPos=(null!=(o=null==r||null==r.getAdPosition?void 0:r.getAdPosition())?o:1)-1,i.sessionFlags.likelyBreakPos=n.adBreakPos}catch(e){n.adBreakPos=t?i.sessionFlags.likelyBreakPos:0}n.adType=w[n.adBreak]||"MIDROLL",n.adGid=i.utils.sessionId+"-"+n.adBreak+"-"+n.adBreakPos;try{var s=null==r||null==r.getTotalAds?void 0:r.getTotalAds();i.sessionFlags.totalAds||(i.sessionFlags.totalAds={}),i.sessionFlags.totalAds[n.adBreak]=s}catch(e){}}else t&&(n.adBreak=i.sessionFlags.likelyBreak,n.adBreakPos=i.sessionFlags.likelyBreakPos,n.adType=w[n.adBreak]||"MIDROLL",n.adGid=i.utils.sessionId+"-"+n.adBreak+"-"+n.adBreakPos);return n},this._adError=function(e,t){var n,r,a={type:"error"};return e&&("string"==typeof e?a.err=e:(a.st=null==e||null==e.getType?void 0:e.getType(),a.err=null==e||null==e.getVastErrorCode?void 0:e.getVastErrorCode(),a.err2=null==e||null==e.getErrorCode?void 0:e.getErrorCode())),Object.assign(a,i._getAdPod(t,!0)),(null==(n=i.sessionFlags)||null==(r=n.totalAds)?void 0:r[i.sessionFlags.likelyBreak])?i.sessionFlags.likelyBreakPos<i.sessionFlags.totalAds[i.sessionFlags.likelyBreak]-1?i.sessionFlags.likelyBreakPos++:(i.sessionFlags.likelyBreak++,i.sessionFlags.likelyBreakPos=0):i.sessionFlags.likelyBreakPos++,a},this.PLAYER_EVENTS={"ads-request":function(){var e,t,n,r,a,o={type:"serve",adURL:null==(e=i.player)||null==(t=e.ima3)||null==(n=t.adsRequest)?void 0:n.adTagUrl},s=null==(r=google)||null==(a=r.ima)?void 0:a.VERSION;return s&&(o.adMgV=s),o},"ima3-ads-manager-loaded":function(e){i.sessionFlags.adsManager=e.originalEvent.getAdsManager(),i.log("ima3-ads-manager-loaded",i.sessionFlags.adsManager)},"ima3-loaded":function(e){var t={type:"al"},n=e.originalEvent.getAd();return Object.assign(t,i._getAdPod(n,!1,!0)),t},"ima3-started":function(e){var t={type:"sa"},n=e.originalEvent.getAd();return Object.assign(t,i._getAdPod(n)),t},"ima3-impression":function(e){var t={type:"imp"},n=e.originalEvent.getAd();return Object.assign(t,i._getAdPod(n)),t},"ima3-first-quartile":function(e){var t={type:"efq"},n=e.originalEvent.getAd();return Object.assign(t,i._getAdPod(n)),t},"ima3-midpoint":function(e){var t={type:"esq"},n=e.originalEvent.getAd();return Object.assign(t,i._getAdPod(n)),t},"ima3-third-quartile":function(e){var t={type:"etq"},n=e.originalEvent.getAd();return Object.assign(t,i._getAdPod(n)),t},"ima3-complete":function(e){var t={type:"ecp"},n=e.originalEvent.getAd();return Object.assign(t,i._getAdPod(n)),t},"ima3-volume-changed":function(e){var t=e.originalEvent.getAd();if(0===(null==t?void 0:t.data_.volume)){var n={type:"mute"};return Object.assign(n,i._getAdPod(t)),n}},"ima3-click":function(e){var t={type:"adClick"},n=e.originalEvent.getAd();return Object.assign(t,i._getAdPod(n)),t},"ima3-skip":function(e){var t={type:"skip"},n=e.originalEvent.getAd();return Object.assign(t,i._getAdPod(n)),t},"ima3-ad-error":function(e){var t,n;return i._adError(e.originalEvent.getError(),null==(t=i.sessionFlags)||null==(n=t.adsManager)?void 0:n.currentAd_)},"ima3-log":function(e){var t,n;return i.log("handling",e.type,"error"),i._adError(null==(t=e.originalEvent)||null==t.getAdData||null==(n=t.getAdData())?void 0:n.adError,e.originalEvent.getAd())},"ima3-hardtimeout":function(){return i.sessionFlags.hasPreviousError=!0,{type:"error",st:"ima",err:"ima3-hardtimeout"}},ima3error:function(){return i.sessionFlags.hasPreviousError=!0,{type:"error",st:"player",err:"ima3error"}},analytics_request:function(e){if(e&&e.params&&e.params.event){if("video_impression"===e.params.event)return{type:"vready",autoplay:e.params.autoplay||!1};if("video_view"===e.params.event)return{type:"vview"}}},play:function(){if(!i.sessionFlags.play)return i.sessionFlags.play=!0,{type:"play"}},playing:function(){if(!i.sessionFlags.c0)return i.sessionFlags.c0=!0,{type:"c0"}},timeupdate:function(){if(i.sessionFlags.c0){var e=Math.floor(100*i.player.currentTime()/i.player.duration());if(!i.sessionFlags.c95&&e>=95)return i.sessionFlags.c95=!0,i.sessionFlags.c75=!0,i.sessionFlags.c50=!0,i.sessionFlags.c25=!0,{type:"c95"};if(!i.sessionFlags.c75&&e>=75)return i.sessionFlags.c75=!0,i.sessionFlags.c50=!0,i.sessionFlags.c25=!0,{type:"c75"};if(!i.sessionFlags.c50&&e>=50)return i.sessionFlags.c50=!0,i.sessionFlags.c25=!0,{type:"c50"};if(!i.sessionFlags.c25&&e>=25)return i.sessionFlags.c25=!0,{type:"c25"}}}},this.start=function(){i.utils=new p(i.options,{getVideoSlot:i.getVideoSlot,getAdBlock:i.getAdBlock,getMediaId:i.getMediaId,getPlayerId:i.getPlayerId,getPlayerVersion:i.getPlayerVersion}),i.log=i.utils.logger("WTAT.bc-ima"),Object.assign(i.PLAYER_EVENTS,y(window,["wtatCustom","events"],{}),i.PLAYER_EVENTS),Object.keys(i.PLAYER_EVENTS).forEach((function(e){i.player.on(e,i._onPlayerEvent)})),i.player.on("loadstart",i.resetState),i.player.on("ended",i.resetState)},this.resetState=function(e){var t,n,r,a;(("loadstart"!==e.type||i.resetOnLoadStart)&&(i.sessionFlags={likelyBreak:0,likelyBreakPos:0},i.utils.createSession()),i.resetOnLoadStart="loadstart"===e.type,"loadstart"===e.type)&&((null==(t=i.player)||null==(n=t.mediainfo)?void 0:n.id)&&(i.sessionFlags.mediaId=i.player.mediainfo.id,(null==(r=i.player)||null==(a=r.bcinfo)?void 0:a.accountId)&&(i.sessionFlags.mediaId=i.player.bcinfo.accountId+":"+i.sessionFlags.mediaId)))},this._onPlayerEvent=function(e){if(i.PLAYER_EVENTS[e.type]){var t;if("function"==typeof i.PLAYER_EVENTS[e.type])try{t=i.PLAYER_EVENTS[e.type](e)}catch(t){i.log("Error executing event listener for",e.type,t.message)}else t=!0===i.PLAYER_EVENTS[e.type]?{type:e.type}:i.PLAYER_EVENTS[e.type];t&&(t.type?i.utils.sendData(t):i.log("Encountered an event without a type. Not sending",e.type,t))}else i.log("Untracked player event triggered",e.type,e)},this._honeyPot=function(){var e=document.createElement("div");e.className=f,e.innerHTML="&nbsp;",e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.background="transparent";try{i.player.el().appendChild(e),i.sessionFlags.honeyPotOk=!0}catch(e){i.log("cannot attach honeypot",e.message)}},this.getVideoSlot=function(){return i.player.el()},this.getMediaId=function(){return i.sessionFlags.mediaId},this.getPlayerId=function(){var e,t,n,r,a,o,s,l;return(null==(e=i.player)||null==(t=e.bcinfo)?void 0:t.accountId)&&(null==(n=i.player)||null==(r=n.bcinfo)?void 0:r.playerId)?i.player.bcinfo.accountId+":"+i.player.bcinfo.playerId:(null==(a=i.player)||null==(o=a.options_)?void 0:o["data-account"])&&(null==(s=i.player)||null==(l=s.options_)?void 0:l["data-player"])?i.player.options_["data-account"]+":"+i.player.options_["data-player"]:void 0},this.getPlayerVersion=function(){return y(i.player,["bcAnalytics","settings","platformVersion"])},this.getAdBlock=function(){if(!i.sessionFlags.honeyPotOk)return-1;try{var e=i.player.el().getElementsByClassName(f),t=e[e.length-1];return t&&null!==t.offsetParent&&t.className===f&&0!==t.innerHTML.length&&0!==t.clientHeight?0:1}catch(e){return i.log("error getting ad block status",e.message),-2}},this.player=e,this.options=t,this.options.src=this.SHORT_NAME,"debug"===this.options.debug)debugger;this._honeyPot()},v)}).wtatBCIma={},m),A={v:b},E={};try{var I=localStorage.getItem("wtDebug"),k=localStorage.getItem("wtUrl");I&&(E.debug=I),k&&(E.wtUrl=k)}catch(e){}function S(e){var t=this;void 0===e&&(e={}),this.ready((function(){var i=Object.assign({},A,e);Object.keys(P.modules).forEach((function(n){var r=Object.assign({},i,P[n],e[n],E);new P.modules[n](t,r).start(),t.addClass("wtat-"+n)}))}))}return(videojs.registerPlugin||videojs.plugin)("wtAdTracer",S),S.VERSION=b,S}();
