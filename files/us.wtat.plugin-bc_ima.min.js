var wtAdTracer=function(){"use strict";function e(t,n){return(e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(t,n)}function t(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function i(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=0;function r(e){return"__private_"+o+++"_"+e}function a(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var s,l=function(){function e(){this.player=void 0,this.utils=void 0,this.SHORT_NAME="Must be implemented",this.PLAYER_EVENTS={}}var t=e.prototype;return t.start=function(){},t.getVideoSlot=function(){},t.getMediaId=function(){},t.getPlayerId=function(){},t.getPlayerVersion=function(){},t.getAdBlock=function(){},t.getAdMgV=function(){},t.getIdx=function(){},t.getPercentViewable=function(){},t.getIsLive=function(){},e}(),d={endpoint:"https://us.q2s15.com/v5/in",batchSize:5,batchInterval:1e3,debug:!1},u={0:[]},c=0,g=!1,p=!1,v=function(){if(d.debug)try{for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.warn.apply(null,["%cWTAT.stream","background:#ffd400;color:#000;padding:2px"].concat(t))}catch(e){}};function f(){d.batchInterval>0&&(s=setInterval(m,d.batchInterval))}function y(){clearInterval(s)}function m(){if(!g){g=!0,y();var e=c;u[c+1]=[],c++,u[e].length&&function(e,t){v("sending",e);try{var n=JSON.stringify(e);if(navigator.sendBeacon){var i=new FormData;i.append("batch",n),i.append("apiKey",d.apiKey),navigator.sendBeacon(d.endpoint,i)||v("beacon queue error"),h(t)}else{var o=new XMLHttpRequest;o.open("POST",d.endpoint,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.setRequestHeader("x-api-key",d.apiKey),o.setRequestHeader("Connection","keep-alive"),o.onreadystatechange=function(){h(t)},o.send("batch="+encodeURIComponent(n))}}catch(e){v("xhr error",e.message)}}(u[e],e),g=!1,f()}}function h(e){delete u[e]}var w=function(){function e(e){void 0===e&&(e={}),d=Object.assign(d,e),f()}var t=e.prototype;return t.push=function(e){!p&&e&&(v("received",e),u[c].push(e),u[c].length>=d.batchSize&&m())},t.stop=function(){p=!0,u[c].length&&m(),y()},e}(),b=function(e,t){var n,i=this;this.options={debug:!1,sendAllCustom:!1},this.sessionId=void 0,this.loopIdx=0,this.staticData={},this.sessionFlags={},this.env={},this.stream=void 0,this.createGuid=function(){for(var e="",t=0;t<12;t++)e+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXZY01234567890".charAt(Math.floor(64*Math.random()));return Date.now()+"-"+e},this.createSession=function(){var e,t,n=!1;try{n=!!window.top.innerWidth||!!window.top.document.documentElement.clientWidth||!!window.top.document.body.clientWidth}catch(e){}i.sessionFlags={firstTimeDataSent:!1,isFif:n,sessionStartTime:Date.now()},i.sessionId=i.createGuid(),0===i.loopIdx&&(i.playlistId=i.createGuid()),i.loopIdx+=1;var o=function(){var e,t;try{var n=I(window.top);e=n[0],t=n[1]}catch(e){}if(!e){var i=window,o=I(i);e=o[0],t=o[1];try{for(;i.parent&&i!==i.parent;){var r=I(i.parent);e=r[0],t=r[1],i=i.parent}}catch(e){}}return[e,t]}();return i.sessionFlags.ww=o[0],i.sessionFlags.wh=o[1],i.sessionFlags.pu=function(e){var t=document.referrer;!t&&e&&(t=document.documentURI);try{var n,i;(window.location===window.parent.location||!t&&null!=(n=document)&&null!=(i=n.location)&&i.href)&&(t=document.location.href)}catch(e){}return t}(n),i.staticData={rid:i.sessionId,idx:(null==(e=i.env)||null==e.getIdx?void 0:e.getIdx())||i.loopIdx,plGid:i.playlistId,src:i.options.src,v:i.options.v,plV:null==(t=i.env)||null==t.getPlayerVersion?void 0:t.getPlayerVersion(),fif:+i.sessionFlags.isFif,domain:F(i.sessionFlags.pu)},i.sessionId},this.sendData=function(e){i.stream.push(i.gatherData(e))},this.gatherData=function(e){var t,n,o;void 0===e&&(e={});var r,a=Object.assign({},e,i.staticData,{mediaId:null==(t=i.env)||null==t.getMediaId?void 0:t.getMediaId(),playerId:null==(n=i.env)||null==n.getPlayerId?void 0:n.getPlayerId(),cst:Date.now()-i.sessionFlags.sessionStartTime,pVisible:E(),isLive:null==(o=i.env)||null==o.getIsLive?void 0:o.getIsLive()});i.sessionFlags.firstTimeDataSent||(i.sessionFlags.firstTimeDataSent=!0,a.cst=0,a.ww=i.sessionFlags.ww,a.wh=i.sessionFlags.wh,a.pu=i.sessionFlags.pu);try{var s=i.env.getVideoSlot();if(s){var l,d;a.per=null!=(l=null==(d=i.env)||null==d.getPercentViewable?void 0:d.getPercentViewable())?l:function(e,t){if(!e)return;try{var n=window.getComputedStyle(e,null),i=n.getPropertyValue("visibility"),o=n.getPropertyValue("display");if("hidden"===i||"none"===o)return 0;try{if(t){var r=I(window.top),a=r[0],s=r[1],l=e.getBoundingClientRect(),d=0,u=0;if(a===1/0||s===1/0)return;var c=P(e,window);try{d=c.bottom<0||c.top>s?0:c.top<s&&c.bottom>s?(s-c.top)/l.height*100:c.top<0&&c.bottom>0?c.bottom/l.height*100:100,u=c.right<0||c.left>a?0:c.left<a&&c.right>a?(a-c.left)/l.width*100:c.left<0&&c.right>0?c.right/l.width*100:100}catch(e){return}return parseInt(u*d/100,10)}}catch(e){}}catch(e){}}(s,i.sessionFlags.isFif);var u=s.getBoundingClientRect();a.w=parseInt(u.width,10),a.h=parseInt(u.height,10)}}catch(e){i.log("gatherData ERROR reading ad WxH:",e.message)}try{var c=A(window,["wtatCustom","fields"],{});Object.keys(c).length&&(a.custom=a.custom||{},Object.entries(c).forEach((function(e){var t=e[0],n=e[1];"function"==typeof n?a.custom[t]=n(a):!i.options.sendAllCustom&&i.sessionFlags.staticCustomSent||(a.custom[t]=n)}))),i.sessionFlags.staticCustomSent=!0}catch(e){i.log("gatherData error",e.message)}if(r=a,!A(window,["wtatCustom","ignoredEvents"],[]).some((function(e){return Object.entries(e).every((function(e){var t=e[0],n=e[1];return A(r,t)===n}))})))return a},this.logger=function(e){return function(){if(i.options.debug)try{for(var t,n,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];console.warn.apply(null,["%c"+e+" "+(null!=(t=null==(n=i.env)||null==n.getPlayerId?void 0:n.getPlayerId())?t:""),"background:#ffd400;color:#000;padding:2px"].concat(r))}catch(e){}}},this.options=Object.assign(this.options,e),this.env=t;var o={debug:this.options.debug,apiKey:this.options.apiKey};this.options.wtUrl&&(o.endpoint=this.options.wtUrl),window&&window.wtStream?this.stream=window.wtStream:(this.stream=new w(o),window&&(window.wtStream=this.stream)),this.log=this.logger("WTAT.core",this.options.debug,null==(n=this.env)||null==n.getPlayerId?void 0:n.getPlayerId()),this.log("version",this.options.v)};function A(e,t,n){if(!e)return n;for(var o,r=e,a=i(Array.isArray(t)?t:t.split("."));!(o=a()).done;){var s=o.value;if(void 0===r[s])return n;r=r[s]}return r}function E(){return void 0!==document.visibilityState?Number("visible"===document.visibilityState):void 0!==document.hidden?Number(!document.hidden):void 0}function P(e,t){var n=t,i=t.parent,o={left:0,right:0,top:0,bottom:0};if(e){var r=e.getBoundingClientRect();n!==i&&(o=P(n.frameElement,i)),o={left:r.left+o.left,right:r.right+o.left,top:r.top+o.top,bottom:r.bottom+o.top}}return o}function I(e){var t=1/0,n=1/0;return!isNaN(e.document.body.clientWidth)&&e.document.body.clientWidth>0&&(t=e.document.body.clientWidth),!isNaN(e.document.body.clientHeight)&&e.document.body.clientHeight>0&&(n=e.document.body.clientHeight),e.document.documentElement&&e.document.documentElement.clientWidth&&!isNaN(e.document.documentElement.clientWidth)&&(t=e.document.documentElement.clientWidth),e.document.documentElement&&e.document.documentElement.clientHeight&&!isNaN(e.document.documentElement.clientHeight)&&(n=e.document.documentElement.clientHeight),e.innerWidth&&!isNaN(e.innerWidth)&&(t=Math.min(t,e.innerWidth)),e.innerHeight&&!isNaN(e.innerHeight)&&(n=Math.min(n,e.innerHeight)),[t,n]}function F(e){if(e)try{return new URL(e).hostname}catch(e){}}var k="afs_ads",S=r("getEventData"),_=function(n){var o,r;function s(e,o){var r;if(void 0===o&&(o={}),(r=n.call(this)||this).player=void 0,r.options=void 0,r.sessionFlags={likelyBreak:0,likelyBreakPos:0},r.resetOnLoadStart=!1,r.log=function(){},r.utils=void 0,r.SHORT_NAME="bc-ima",r._getAdDetails=function(e){if(e)return{adId:e.getAdId(),adSys:e.getAdSystem(),adAN:e.getAdvertiserName(),adDID:e.getDealId(),adWId:e.getWrapperAdIds(),adWSys:e.getWrapperAdSystems(),adMU:e.getMediaUrl(),adCId:e.getCreativeId(),adWCId:e.getWrapperCreativeIds()}},r._getAdPod=function(e,t){void 0===t&&(t=!1);var n={adMgV:r.getAdMgV()},i=null==e||null==e.getAdPodInfo?void 0:e.getAdPodInfo();if(i){try{var o;n.adBreak=null!=(o=null==i||null==i.getPodIndex?void 0:i.getPodIndex())?o:0,r.sessionFlags.likelyBreak=n.adBreak}catch(e){n.adBreak=t?r.sessionFlags.likelyBreak:0}try{var a;n.adBreakPos=(null!=(a=null==i||null==i.getAdPosition?void 0:i.getAdPosition())?a:1)-1,r.sessionFlags.likelyBreakPos=n.adBreakPos}catch(e){n.adBreakPos=t?r.sessionFlags.likelyBreakPos:0}n.adGid=r.utils.sessionId+"-"+n.adBreak+"-"+n.adBreakPos;try{var s=null==i||null==i.getTotalAds?void 0:i.getTotalAds();r.sessionFlags.totalAds||(r.sessionFlags.totalAds={}),r.sessionFlags.totalAds[n.adBreak]=s}catch(e){}}else t&&(n.adBreak=r.sessionFlags.likelyBreak,n.adBreakPos=r.sessionFlags.likelyBreakPos,n.adGid=r.utils.sessionId+"-"+n.adBreak+"-"+n.adBreakPos);return n},r._adError=function(e,t){var n,i,o={type:"error"};return e&&("string"==typeof e?o.err=e:(o.st=null==e||null==e.getType?void 0:e.getType(),o.err=null==e||null==e.getVastErrorCode?void 0:e.getVastErrorCode(),o.err2=null==e||null==e.getErrorCode?void 0:e.getErrorCode())),Object.assign(o,r._getAdPod(t,!0)),null!=(n=r.sessionFlags)&&null!=(i=n.totalAds)&&i[r.sessionFlags.likelyBreak]?r.sessionFlags.likelyBreakPos<r.sessionFlags.totalAds[r.sessionFlags.likelyBreak]-1?r.sessionFlags.likelyBreakPos++:(r.sessionFlags.likelyBreak++,r.sessionFlags.likelyBreakPos=0):r.sessionFlags.likelyBreakPos++,o},r.PLAYER_EVENTS={loadstart:function(){return r.sessionFlags.resetOnInit&&r.resetState(),r.sessionFlags.resetOnInit=!0,{type:"init",aBl:r.getAdBlock()}},ended:function(){r.resetState()},"ads-request":function(){var e,t,n;return{type:"serve",adURL:null==(e=r.player)||null==(t=e.ima3)||null==(n=t.adsRequest)?void 0:n.adTagUrl,adMgV:r.getAdMgV()}},"ima3-ads-manager-loaded":function(e){r.sessionFlags.adsManager=e.originalEvent.getAdsManager()},"ima3-loaded":function(e){var t={type:"al"},n=e.originalEvent.getAd();return Object.assign(t,r._getAdDetails(n)),Object.assign(t,r._getAdPod(n)),t},"ima3-started":function(e){var t={type:"sa"},n=e.originalEvent.getAd();return Object.assign(t,r._getAdPod(n)),t},"ima3-impression":function(e){var t={type:"imp"},n=e.originalEvent.getAd();return Object.assign(t,r._getAdPod(n)),t},"ima3-first-quartile":function(e){var t={type:"efq"},n=e.originalEvent.getAd();return Object.assign(t,r._getAdPod(n)),t},"ima3-midpoint":function(e){var t={type:"esq"},n=e.originalEvent.getAd();return Object.assign(t,r._getAdPod(n)),t},"ima3-third-quartile":function(e){var t={type:"etq"},n=e.originalEvent.getAd();return Object.assign(t,r._getAdPod(n)),t},"ima3-complete":function(e){var t={type:"ecp"},n=e.originalEvent.getAd();return Object.assign(t,r._getAdPod(n)),t},"ima3-volume-changed":function(e){var t=e.originalEvent.getAd();if(0===(null==t?void 0:t.data_.volume)){var n={type:"mute"};return Object.assign(n,r._getAdPod(t)),n}},"ima3-click":function(e){var t={type:"adClick"},n=e.originalEvent.getAd();return Object.assign(t,r._getAdPod(n)),t},"ima3-ad-error":function(e){var t,n;return r._adError(e.originalEvent.getError(),null==(t=r.sessionFlags)||null==(n=t.adsManager)?void 0:n.currentAd_)},"ima3-log":function(e){var t,n;return r.log("handling",e.type,"error"),r._adError(null==(t=e.originalEvent)||null==t.getAdData||null==(n=t.getAdData())?void 0:n.adError,e.originalEvent.getAd())},"ima3-hardtimeout":function(){return r.sessionFlags.hasPreviousError=!0,{type:"error",st:"ima",err:"ima3-hardtimeout"}},ima3error:function(){return r.sessionFlags.hasPreviousError=!0,{type:"error",st:"player",err:"ima3error"}},analytics_request:function(e){var t;if(null!=e&&null!=(t=e.params)&&t.event){if("video_impression"===e.params.event)return{type:"vready",autoplay:e.params.autoplay||!1};if("video_view"===e.params.event)return{type:"vview"}}},play:function(){if(!r.sessionFlags.play)return r.sessionFlags.play=!0,{type:"play"}},playing:function(){if(!r.sessionFlags.c0)return r.sessionFlags.c0=!0,{type:"c0"}},timeupdate:function(){if(r.sessionFlags.c0){var e=Math.floor(100*r.player.currentTime()/r.player.duration());if(!r.sessionFlags.c95&&e>=95)return r.sessionFlags.c95=!0,r.sessionFlags.c75=!0,r.sessionFlags.c50=!0,r.sessionFlags.c25=!0,{type:"c95"};if(!r.sessionFlags.c75&&e>=75)return r.sessionFlags.c75=!0,r.sessionFlags.c50=!0,r.sessionFlags.c25=!0,{type:"c75"};if(!r.sessionFlags.c50&&e>=50)return r.sessionFlags.c50=!0,r.sessionFlags.c25=!0,{type:"c50"};if(!r.sessionFlags.c25&&e>=25)return r.sessionFlags.c25=!0,{type:"c25"}}}},r.start=function(){r.utils=new b(r.options,t(r)),r.log=r.utils.logger("WTAT."+r.SHORT_NAME),r.resetState(),r._honeyPot();for(var e=0,n=Object.entries(A(window,["wtatCustom","events"],{}));e<n.length;e++){var i=n[e],o=i[0],a=i[1];r.PLAYER_EVENTS[o]?r.PLAYER_EVENTS[o]=[r.PLAYER_EVENTS[o],a]:r.PLAYER_EVENTS[o]=a}Object.keys(r.PLAYER_EVENTS).forEach((function(e){r.player.on(e,r._onPlayerEvent)}))},r.resetState=function(){r.log("resetting state"),r.sessionFlags={likelyBreak:0,likelyBreakPos:0},r.utils.createSession()},Object.defineProperty(t(r),S,{writable:!0,value:function(e,n){var o;if("function"==typeof e)try{o=e(n)}catch(e){r.log("Error executing event listener for",n.type,e.message)}else if(!0===e)o={type:n.type};else if(Array.isArray(e)){o=[];for(var s,l=i(e);!(s=l()).done;){var d=s.value;o.push(a(t(r),S)[S](d,n))}}else o=e;return o}}),r._onPlayerEvent=function(e){if(r.PLAYER_EVENTS[e.type]){var n=a(t(r),S)[S](r.PLAYER_EVENTS[e.type],e);Array.isArray(n)&&(n=Object.assign.apply(Object,n)),n&&(n.type?r.utils.sendData(n):r.log("Encountered an event without a type. Not sending",e.type,n))}else r.log("Untracked player event triggered",e.type,e)},r._honeyPot=function(){var e=document.createElement("div");e.className=k,e.innerHTML="&nbsp;",e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.background="transparent";try{document.body.appendChild(e),r.sessionFlags.honeyPotOk=!0,r.log("ad blocker honeypot installed")}catch(e){r.log("cannot attach honeypot",e.message)}},r.getVideoSlot=function(){return r.player.el()},r.getMediaId=function(){var e,t,n,i,o;null!=(e=r.player)&&null!=(t=e.mediainfo)&&t.id&&(n=r.player.mediainfo.id,null!=(i=r.player)&&null!=(o=i.bcinfo)&&o.accountId&&(n=r.player.bcinfo.accountId+":"+n));return n},r.getPlayerId=function(){var e,t,n,i,o,a,s,l;return null!=(e=r.player)&&null!=(t=e.bcinfo)&&t.accountId&&null!=(n=r.player)&&null!=(i=n.bcinfo)&&i.playerId?r.player.bcinfo.accountId+":"+r.player.bcinfo.playerId:null!=(o=r.player)&&null!=(a=o.options_)&&a["data-account"]&&null!=(s=r.player)&&null!=(l=s.options_)&&l["data-player"]?r.player.options_["data-account"]+":"+r.player.options_["data-player"]:void 0},r.getPlayerVersion=function(){return A(r.player,["bcAnalytics","settings","platformVersion"])},r.getAdBlock=function(){if(!r.sessionFlags.honeyPotOk)return-1;try{var e=document.body.getElementsByClassName(k),t=e[e.length-1];return t&&null!==t.offsetParent&&t.className===k&&0!==t.innerHTML.length&&0!==t.clientHeight?0:1}catch(e){return r.log("error getting ad block status",e.message),-2}},r.getAdMgV=function(){var e,t;return null==(e=google)||null==(t=e.ima)?void 0:t.VERSION},r.getIsLive=function(){if(void 0===r.sessionFlags.isLive)try{r.sessionFlags.isLive=Number([].concat(r.player.el().classList).includes("vjs-live"))}catch(e){}return r.sessionFlags.isLive},r.player=e,r.options=o,r.options.src=r.SHORT_NAME,"debug"===r.options.debug)debugger;return r}return r=n,(o=s).prototype=Object.create(r.prototype),o.prototype.constructor=o,e(o,r),s}(l),O={v:"5.8.0"},C={};try{var B=localStorage.getItem("wtDebug"),T=localStorage.getItem("wtUrl");B&&(C.debug=B),T&&(C.wtUrl=T)}catch(e){}function N(e){var t=this;void 0===e&&(e={}),this.ready((function(){var n=Object.assign({},O,e,C);n.wtatCustom&&(window.wtatCustom=window.wtatCustom||{},n.wtatCustom.fields&&(window.wtatCustom.fields=Object.assign({},window.wtatCustom.fields||{},n.wtatCustom.fields)),n.wtatCustom.events&&(window.wtatCustom.events=Object.assign({},window.wtatCustom.events||{},n.wtatCustom.events)),n.wtatCustom.ignoredEvents&&(window.wtatCustom.ignoredEvents=[].concat(window.wtatCustom.ignoredEvents||[],n.wtatCustom.ignoredEvents)),delete n.wtatCustom),new _(t,n).start()}))}return(videojs.registerPlugin||videojs.plugin)("wtAdTracer",N),N}();
