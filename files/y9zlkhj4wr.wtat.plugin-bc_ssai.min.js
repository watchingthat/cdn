var wtAdTracer=function(){"use strict";function e(t,n){return e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e(t,n)}function t(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function s(e,t){var s="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(s)return(s=s.call(e)).next.bind(s);if(Array.isArray(e)||(s=function(e,t){if(e){if("string"==typeof e)return n(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){s&&(e=s);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=0;function o(e){return"__private_"+i+++"_"+e}function a(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var r,l=function(){function e(){this.player=void 0,this.utils=void 0,this.SHORT_NAME="Must be implemented",this.PLAYER_EVENTS={}}var t=e.prototype;return t.start=function(){},t.getVideoSlot=function(){},t.getMediaId=function(){},t.getPlayerId=function(){},t.getPlayerVersion=function(){},t.getAdBlock=function(){},t.getAdMgV=function(){},t.getIdx=function(){},t.getPercentViewable=function(){},t.getIsLive=function(){},e}(),d={endpoint:"https://y9zlkhj4wr.ey8jd.com/v5/in",batchSize:5,batchInterval:1e3,debug:!1},u={0:[]},c=0,g=!1,p=!1,y=function(){if(d.debug)try{for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.warn.apply(null,["%cWTAT.stream","background:#ffd400;color:#000;padding:2px"].concat(t))}catch(e){}};function f(){d.batchInterval>0&&(r=setInterval(h,d.batchInterval))}function v(){clearInterval(r)}function h(){if(!g){g=!0,v();var e=c;u[c+1]=[],c++,u[e].length&&function(e,t){y("sending",e);try{var n=JSON.stringify(e);if(navigator.sendBeacon){var s=new FormData;s.append("batch",n),s.append("apiKey",d.apiKey),navigator.sendBeacon(d.endpoint,s)||y("beacon queue error"),m(t)}else{var i=new XMLHttpRequest;i.open("POST",d.endpoint,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.setRequestHeader("x-api-key",d.apiKey),i.setRequestHeader("Connection","keep-alive"),i.onreadystatechange=function(){m(t)},i.send("batch="+encodeURIComponent(n))}}catch(e){y("xhr error",e.message)}}(u[e],e),g=!1,f()}}function m(e){delete u[e]}var w=function(){function e(e){void 0===e&&(e={}),d=Object.assign(d,e),f()}var t=e.prototype;return t.push=function(e){!p&&e&&(y("received",e),u[c].push(e),u[c].length>=d.batchSize&&h())},t.stop=function(){p=!0,u[c].length&&h(),v()},e}(),b=function(e,t){var n,s=this;this.options={debug:!1,sendAllCustom:!1},this.sessionId=void 0,this.loopIdx=0,this.staticData={},this.sessionFlags={},this.env={},this.stream=void 0,this.createGuid=function(){for(var e="",t=0;t<12;t++)e+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXZY01234567890".charAt(Math.floor(64*Math.random()));return Date.now()+"-"+e},this.createSession=function(){var e,t,n=!1;try{n=!!window.top.innerWidth||!!window.top.document.documentElement.clientWidth||!!window.top.document.body.clientWidth}catch(e){}s.sessionFlags={firstTimeDataSent:!1,isFif:n,sessionStartTime:Date.now()},s.sessionId=s.createGuid(),0===s.loopIdx&&(s.playlistId=s.createGuid()),s.loopIdx+=1;var i=function(){var e,t;try{var n=F(window.top);e=n[0],t=n[1]}catch(e){}if(!e){var s=window,i=F(s);e=i[0],t=i[1];try{for(;s.parent&&s!==s.parent;){var o=F(s.parent);e=o[0],t=o[1],s=s.parent}}catch(e){}}return[e,t]}();return s.sessionFlags.ww=i[0],s.sessionFlags.wh=i[1],s.sessionFlags.pu=function(e){var t=document.referrer;!t&&e&&(t=document.documentURI);try{var n;(window.location===window.parent.location||!t&&null!=(n=document)&&null!=(n=n.location)&&n.href)&&(t=document.location.href)}catch(e){}return t}(n),s.staticData={rid:s.sessionId,idx:(null==(e=s.env)||null==e.getIdx?void 0:e.getIdx())||s.loopIdx,plGid:s.playlistId,src:s.options.src,v:s.options.v,plV:null==(t=s.env)||null==t.getPlayerVersion?void 0:t.getPlayerVersion(),fif:+s.sessionFlags.isFif,domain:k(s.sessionFlags.pu)},s.sessionId},this.sendData=function(e){s.stream.push(s.gatherData(e))},this.gatherData=function(e){var t,n,i;void 0===e&&(e={});var o,a=Object.assign({},e,s.staticData,{mediaId:null==(t=s.env)||null==t.getMediaId?void 0:t.getMediaId(),playerId:null==(n=s.env)||null==n.getPlayerId?void 0:n.getPlayerId(),cst:Date.now()-s.sessionFlags.sessionStartTime,pVisible:P(),isLive:null==(i=s.env)||null==i.getIsLive?void 0:i.getIsLive()});s.sessionFlags.firstTimeDataSent||(s.sessionFlags.firstTimeDataSent=!0,a.cst=0,a.ww=s.sessionFlags.ww,a.wh=s.sessionFlags.wh,a.pu=s.sessionFlags.pu);try{var r=s.env.getVideoSlot();if(r){var l,d;a.per=null!=(l=null==(d=s.env)||null==d.getPercentViewable?void 0:d.getPercentViewable())?l:function(e,t){if(!e)return;try{var n=window.getComputedStyle(e,null),s=n.getPropertyValue("visibility"),i=n.getPropertyValue("display");if("hidden"===s||"none"===i)return 0;try{if(t){var o=F(window.top),a=o[0],r=o[1],l=e.getBoundingClientRect(),d=0,u=0;if(a===1/0||r===1/0)return;var c=_(e,window);try{d=c.bottom<0||c.top>r?0:c.top<r&&c.bottom>r?(r-c.top)/l.height*100:c.top<0&&c.bottom>0?c.bottom/l.height*100:100,u=c.right<0||c.left>a?0:c.left<a&&c.right>a?(a-c.left)/l.width*100:c.left<0&&c.right>0?c.right/l.width*100:100}catch(e){return}return parseInt(u*d/100,10)}}catch(e){}}catch(e){}}(r,s.sessionFlags.isFif);var u=r.getBoundingClientRect();a.w=parseInt(u.width,10),a.h=parseInt(u.height,10)}}catch(e){s.log("gatherData ERROR reading ad WxH:",e.message)}try{var c=A(window,["wtatCustom","fields"],{});Object.keys(c).length&&(a.custom=a.custom||{},Object.entries(c).forEach((function(e){var t=e[0],n=e[1];"function"==typeof n?a.custom[t]=n(a):!s.options.sendAllCustom&&s.sessionFlags.staticCustomSent||(a.custom[t]=n)}))),s.sessionFlags.staticCustomSent=!0}catch(e){s.log("gatherData error",e.message)}if(o=a,!A(window,["wtatCustom","ignoredEvents"],[]).some((function(e){return Object.entries(e).every((function(e){var t=e[0],n=e[1];return A(o,t)===n}))})))return a},this.logger=function(e){return function(){if(s.options.debug)try{for(var t,n,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];console.warn.apply(null,["%c"+e+" "+(null!=(t=null==(n=s.env)||null==n.getPlayerId?void 0:n.getPlayerId())?t:""),"background:#ffd400;color:#000;padding:2px"].concat(o))}catch(e){}}},this.options=Object.assign(this.options,e),this.env=t;var i={debug:this.options.debug,apiKey:this.options.apiKey};this.options.wtUrl&&(i.endpoint=this.options.wtUrl),window&&window.wtStream?this.stream=window.wtStream:(this.stream=new w(i),window&&(window.wtStream=this.stream)),this.log=this.logger("WTAT.core",this.options.debug,null==(n=this.env)||null==n.getPlayerId?void 0:n.getPlayerId()),this.log("version",this.options.v)};function A(e,t,n){if(!e)return n;for(var i,o=e,a=s(Array.isArray(t)?t:t.split("."));!(i=a()).done;){var r=i.value;if(void 0===o[r])return n;o=o[r]}return o}function P(){return void 0!==document.visibilityState?Number("visible"===document.visibilityState):void 0!==document.hidden?Number(!document.hidden):void 0}function _(e,t){var n=t,s=t.parent,i={left:0,right:0,top:0,bottom:0};if(e){var o=e.getBoundingClientRect();n!==s&&(i=_(n.frameElement,s)),i={left:o.left+i.left,right:o.right+i.left,top:o.top+i.top,bottom:o.bottom+i.top}}return i}function F(e){var t=1/0,n=1/0;return!isNaN(e.document.body.clientWidth)&&e.document.body.clientWidth>0&&(t=e.document.body.clientWidth),!isNaN(e.document.body.clientHeight)&&e.document.body.clientHeight>0&&(n=e.document.body.clientHeight),e.document.documentElement&&e.document.documentElement.clientWidth&&!isNaN(e.document.documentElement.clientWidth)&&(t=e.document.documentElement.clientWidth),e.document.documentElement&&e.document.documentElement.clientHeight&&!isNaN(e.document.documentElement.clientHeight)&&(n=e.document.documentElement.clientHeight),e.innerWidth&&!isNaN(e.innerWidth)&&(t=Math.min(t,e.innerWidth)),e.innerHeight&&!isNaN(e.innerHeight)&&(n=Math.min(n,e.innerHeight)),[t,n]}function k(e){if(e)try{return new URL(e).hostname}catch(e){}}var E="afs_ads",O=o("getEventData"),I=function(n){var i,o;function r(e,i){var o;if(void 0===i&&(i={}),(o=n.call(this)||this).player=void 0,o.options=void 0,o.sessionFlags={likelyBreak:0,likelyBreakPos:0},o.resetOnLoadStart=!1,o.log=function(){},o.utils=void 0,o.SHORT_NAME="bc-ssai",o._getAdDetails=function(){var e,t,n=null==(e=o.player.ads)?void 0:e.ad;return{adId:null==n?void 0:n.id,adSys:null==n?void 0:n.system,adAN:null==n?void 0:n.advertiser,adDID:null==n?void 0:n.deal_id,adWId:null!=(t=null==n?void 0:n.wrapper_ad_ids)?t:null==n?void 0:n.wrapper_ids,adWSys:null==n?void 0:n.wrapper_systems,adCId:null==n?void 0:n.creative_id,adWCId:null==n?void 0:n.wrapper_creative_ids}},o._getAdPod=function(){var e={adMgV:o.getAdMgV()},t=o.player.ads.pod,n=o.player.ads.ad;void 0!==(null==t?void 0:t.index)?(e.adBreak=t.index,o.sessionFlags.likelyBreak=e.adBreak):e.adBreak=o.sessionFlags.likelyBreak,void 0!==(null==n?void 0:n.index)?(e.adBreakPos=n.index,o.sessionFlags.likelyBreakPos=e.adBreakPos):e.adBreakPos=o.sessionFlags.likelyBreakPos,e.adGid=o.utils.sessionId+"-"+e.adBreak+"-"+e.adBreakPos;var s=null==t?void 0:t.ad_count;return o.sessionFlags.totalAds||(o.sessionFlags.totalAds={}),o.sessionFlags.totalAds[e.adBreak]=s,e},o._adError=function(e,t){var n,s={type:"error"};return e&&("string"==typeof e?s.err=e:(s.st=null==e||null==e.getType?void 0:e.getType(),s.err=null==e||null==e.getVastErrorCode?void 0:e.getVastErrorCode(),s.err2=null==e||null==e.getErrorCode?void 0:e.getErrorCode())),Object.assign(s,o._getAdPod(t,!0)),null!=(n=o.sessionFlags)&&null!=(n=n.totalAds)&&n[o.sessionFlags.likelyBreak]?o.sessionFlags.likelyBreakPos<o.sessionFlags.totalAds[o.sessionFlags.likelyBreak]-1?o.sessionFlags.likelyBreakPos++:(o.sessionFlags.likelyBreak++,o.sessionFlags.likelyBreakPos=0):o.sessionFlags.likelyBreakPos++,s},o.PLAYER_EVENTS={loadstart:function(){return o.sessionFlags.resetOnInit&&o.resetState(),o.sessionFlags.resetOnInit=!0,{type:"init",aBl:o.getAdBlock()}},ended:function(){o.resetState()},"ads-request":function(){return{type:"serve",adMgV:o.getAdMgV()}},"ads-pod-started":function(){var e={type:"adBreak"};return Object.assign(e,o._getAdPod()),e},"ads-load":function(){var e={type:"al"};return Object.assign(e,o._getAdDetails()),Object.assign(e,o._getAdPod()),e},"ads-ad-started":function(){var e={type:"imp"};return Object.assign(e,o._getAdDetails()),Object.assign(e,o._getAdPod()),e},"ads-impression":function(){var e={type:"imp"};return Object.assign(e,o._getAdDetails()),Object.assign(e,o._getAdPod()),e},"ads-first-quartile":function(){var e={type:"efq"};return Object.assign(e,o._getAdDetails()),Object.assign(e,o._getAdPod()),e},"ads-midpoint":function(){var e={type:"esq"};return Object.assign(e,o._getAdDetails()),Object.assign(e,o._getAdPod()),e},"ads-third-quartile":function(){var e={type:"etq"};return Object.assign(e,o._getAdDetails()),Object.assign(e,o._getAdPod()),e},"ads-ad-ended":function(){var e={type:"ecp"};return Object.assign(e,o._getAdDetails()),Object.assign(e,o._getAdPod()),o.sessionFlags.likelyBreakPos++,e},"ads-pod-ended":function(){o.sessionFlags.likelyBreak++,o.sessionFlags.likelyBreakPos=0},"ads-mute":function(){var e={type:"mute"};return Object.assign(e,o._getAdDetails()),Object.assign(e,o._getAdPod()),e},"ads-unmute":function(){var e={type:"unmute"};return Object.assign(e,o._getAdDetails()),Object.assign(e,o._getAdPod()),e},"ads-pause":function(){var e={type:"pause"};return Object.assign(e,o._getAdDetails()),Object.assign(e,o._getAdPod()),e},"ads-click":function(){var e={type:"adClick"};return Object.assign(e,o._getAdDetails()),Object.assign(e,o._getAdPod()),e},error:function(){var e={type:"error",err:"unknown"};Object.assign(e,o._getAdDetails()),Object.assign(e,o._getAdPod())},aderror:function(){var e={type:"error",err:"unknown"};Object.assign(e,o._getAdDetails()),Object.assign(e,o._getAdPod())},play:function(){if(!o.sessionFlags.play)return o.sessionFlags.play=!0,{type:"play"}},playing:function(){if(!o.sessionFlags.c0)return o.sessionFlags.c0=!0,{type:"c0"}},timeupdate:function(){if(o.sessionFlags.c0){var e=Math.floor(100*o.player.currentTime()/o.player.duration());if(!o.sessionFlags.c95&&e>=95)return o.sessionFlags.c95=!0,o.sessionFlags.c75=!0,o.sessionFlags.c50=!0,o.sessionFlags.c25=!0,{type:"c95"};if(!o.sessionFlags.c75&&e>=75)return o.sessionFlags.c75=!0,o.sessionFlags.c50=!0,o.sessionFlags.c25=!0,{type:"c75"};if(!o.sessionFlags.c50&&e>=50)return o.sessionFlags.c50=!0,o.sessionFlags.c25=!0,{type:"c50"};if(!o.sessionFlags.c25&&e>=25)return o.sessionFlags.c25=!0,{type:"c25"}}}},o.start=function(){o.utils=new b(o.options,t(o)),o.log=o.utils.logger("WTAT."+o.SHORT_NAME),o.resetState(),o._honeyPot();for(var e=0,n=Object.entries(A(window,["wtatCustom","events"],{}));e<n.length;e++){var s=n[e],i=s[0],a=s[1];o.PLAYER_EVENTS[i]?o.PLAYER_EVENTS[i]=[o.PLAYER_EVENTS[i],a]:o.PLAYER_EVENTS[i]=a}Object.keys(o.PLAYER_EVENTS).forEach((function(e){o.player.on(e,o._onPlayerEvent)}))},o.resetState=function(){o.log("resetting state"),o.sessionFlags={likelyBreak:0,likelyBreakPos:0},o.utils.createSession()},Object.defineProperty(t(o),O,{writable:!0,value:function(e,n){var i;if("function"==typeof e)try{i=e(n)}catch(e){o.log("Error executing event listener for",n.type,e.message)}else if(!0===e)i={type:n.type};else if(Array.isArray(e)){i=[];for(var r,l=s(e);!(r=l()).done;){var d=r.value;i.push(a(t(o),O)[O](d,n))}}else i=e;return i}}),o._onPlayerEvent=function(e){if(o.PLAYER_EVENTS[e.type]){var n=a(t(o),O)[O](o.PLAYER_EVENTS[e.type],e);Array.isArray(n)&&(n=Object.assign.apply(Object,n)),n&&(n.type?o.utils.sendData(n):o.log("Encountered an event without a type. Not sending",e.type,n))}else o.log("Untracked player event triggered",e.type,e)},o._honeyPot=function(){var e=document.createElement("div");e.className=E,e.innerHTML="&nbsp;",e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.background="transparent";try{document.body.appendChild(e),o.sessionFlags.honeyPotOk=!0,o.log("ad blocker honeypot installed")}catch(e){o.log("cannot attach honeypot",e.message)}},o.getVideoSlot=function(){return o.player.el()},o.getMediaId=function(){var e,t,n;null!=(e=o.player)&&null!=(e=e.mediainfo)&&e.id&&(t=o.player.mediainfo.id,null!=(n=o.player)&&null!=(n=n.bcinfo)&&n.accountId&&(t=o.player.bcinfo.accountId+":"+t));return t},o.getPlayerId=function(){var e,t,n,s;return null!=(e=o.player)&&null!=(e=e.bcinfo)&&e.accountId&&null!=(t=o.player)&&null!=(t=t.bcinfo)&&t.playerId?o.player.bcinfo.accountId+":"+o.player.bcinfo.playerId:null!=(n=o.player)&&null!=(n=n.options_)&&n["data-account"]&&null!=(s=o.player)&&null!=(s=s.options_)&&s["data-player"]?o.player.options_["data-account"]+":"+o.player.options_["data-player"]:void 0},o.getPlayerVersion=function(){return A(o.player,["bcAnalytics","settings","platformVersion"])},o.getAdBlock=function(){if(!o.sessionFlags.honeyPotOk)return-1;try{var e=document.body.getElementsByClassName(E),t=e[e.length-1];return t&&null!==t.offsetParent&&t.className===E&&0!==t.innerHTML.length&&0!==t.clientHeight?0:1}catch(e){return o.log("error getting ad block status",e.message),-2}},o.getAdMgV=function(){return"ssai"},o.getIsLive=function(){if(void 0===o.sessionFlags.isLive)try{var e;o.sessionFlags.isLive=Number(null==(e=o.player)||null==(e=e.ads)||null==e.isLive?void 0:e.isLive())}catch(e){}return o.sessionFlags.isLive},o.player=e,o.options=i,o.options.src=o.SHORT_NAME,"debug"===o.options.debug)debugger;return o}return o=n,(i=r).prototype=Object.create(o.prototype),i.prototype.constructor=i,e(i,o),r}(l),j={v:"5.9.0"},S={};try{var C=localStorage.getItem("wtDebug"),B=localStorage.getItem("wtUrl");C&&(S.debug=C),B&&(S.wtUrl=B)}catch(e){}function D(e){var t=this;void 0===e&&(e={}),this.ready((function(){var n=Object.assign({},j,e,S);n.wtatCustom&&(window.wtatCustom=window.wtatCustom||{},n.wtatCustom.fields&&(window.wtatCustom.fields=Object.assign({},window.wtatCustom.fields||{},n.wtatCustom.fields)),n.wtatCustom.events&&(window.wtatCustom.events=Object.assign({},window.wtatCustom.events||{},n.wtatCustom.events)),n.wtatCustom.ignoredEvents&&(window.wtatCustom.ignoredEvents=[].concat(window.wtatCustom.ignoredEvents||[],n.wtatCustom.ignoredEvents)),delete n.wtatCustom),new I(t,n).start()}))}return(videojs.registerPlugin||videojs.plugin)("wtAdTracer",D),D}();
