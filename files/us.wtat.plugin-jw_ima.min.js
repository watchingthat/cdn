var wtAdTracer=function(){"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=Array(t);i<t;i++)n[i]=e[i];return n}function t(e,t){if(!{}.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var i=0;function n(e){return"__private_"+i+++"_"+e}function r(t,i){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,i){if(t){if("string"==typeof t)return e(t,i);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,i):void 0}}(t))||i){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},a(e,t)}var s,o=function(){function e(){this.player=void 0,this.utils=void 0,this.SHORT_NAME="Must be implemented",this.PLAYER_EVENTS={}}var t=e.prototype;return t.start=function(){},t.getVideoSlot=function(){},t.getMediaId=function(){},t.getPlayerId=function(){},t.getPlayerVersion=function(){},t.getAdBlock=function(){},t.getAdMgV=function(){},t.getIdx=function(){},t.getPercentViewable=function(){},t.getIsLive=function(){},e}(),l={endpoint:"https://us.q2s15.com/v5/in",batchSize:5,batchInterval:1e3,debug:!1},d={0:[]},c=0,u=!1,h=!1,g=function(){if(l.debug)try{for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];console.warn.apply(null,["%cWTAT.stream","background:#ffd400;color:#000;padding:2px"].concat(t))}catch(e){}};function w(){l.batchInterval>0&&(s=setInterval(m,l.batchInterval))}function v(){clearInterval(s)}function m(){if(!u){u=!0,v();var e=c;d[c+1]=[],c++,d[e].length&&function(e,t){g("sending",e);try{var i=JSON.stringify(e);if(navigator.sendBeacon){var n=new FormData;n.append("batch",i),n.append("apiKey",l.apiKey),navigator.sendBeacon(l.endpoint,n)||g("beacon queue error"),y(t)}else{var r=new XMLHttpRequest;r.open("POST",l.endpoint,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.setRequestHeader("x-api-key",l.apiKey),r.setRequestHeader("Connection","keep-alive"),r.onreadystatechange=function(){y(t)},r.send("batch="+encodeURIComponent(i))}}catch(e){g("xhr error",e.message)}}(d[e],e),u=!1,w()}}function y(e){delete d[e]}var p=function(){function e(e){void 0===e&&(e={}),l=Object.assign(l,e),w()}var t=e.prototype;return t.push=function(e){!h&&e&&(g("received",e),d[c].push(e),d[c].length>=l.batchSize&&m())},t.stop=function(){h=!0,d[c].length&&m(),v()},e}(),f=function(){function e(e){var t;this.wtCore=e,this.observers=new Map,this.resizeObservers=new Map,this.viewabilityCache=new Map,this.dimensionsCache=new Map,this.lastUpdate=0;var i=(null==e||null==(t=e.options)?void 0:t.viewability)||{};this.updateThrottle=i.updateThrottle||200,this.cacheTimeout=i.cacheTimeout||1e3,this.isSupported=this._checkSupport(),this.resizeObserverSupported=this._checkResizeObserverSupport(),this.frameContext=this._detectFrameContext(),this.isSameOriginFrame=this._detectSameOriginFrame(),this.isNestedFrame=this._detectNestedFrame(),this.metrics={observerCalls:0,cacheHits:0,cacheMisses:0,avgCalculationTime:0,totalCalculationTime:0},this.observerOptions={root:null,rootMargin:"0px",threshold:[0,.25,.5,.75,1]},this.handleIntersection=this._throttle(this._handleIntersectionEntries.bind(this),this.updateThrottle),this.handleResize=this._throttle(this._handleResizeEntries.bind(this),this.updateThrottle),"undefined"!=typeof window&&window.addEventListener("beforeunload",this.destroy.bind(this))}var t=e.prototype;return t._checkSupport=function(){return"undefined"!=typeof window&&"IntersectionObserver"in window&&"WeakMap"in window},t._checkResizeObserverSupport=function(){return"undefined"!=typeof window&&"ResizeObserver"in window},t._detectFrameContext=function(){if("undefined"==typeof window)return{isInFrame:!1,isTopLevel:!0,frameDepth:0};try{for(var e=window!==window.top,t=window===window.top,i=0,n=window;n!==n.parent&&i<10;)i++,n=n.parent;return{isInFrame:e,isTopLevel:t,frameDepth:i,hasParent:window!==window.parent}}catch(e){return{isInFrame:!0,isTopLevel:!1,frameDepth:1,hasParent:!0,crossOriginBlocked:!0}}},t._detectSameOriginFrame=function(){if("undefined"==typeof window||!this.frameContext.isInFrame)return!1;try{window.parent.location.hostname,window.location.hostname;return window.parent.location.origin===window.location.origin}catch(e){return!1}},t._detectNestedFrame=function(){return"undefined"!=typeof window&&this.frameContext.frameDepth>1},t._calculateObserverRoot=function(){if(!this.frameContext.isInFrame)return null;if(!this.isSameOriginFrame)return null;try{return 1===this.frameContext.frameDepth?this._getParentViewportElement():this.isNestedFrame?this._getImmediateParentViewport():null}catch(t){var e;return null==(e=this.wtCore)||null==e.log||e.log("ViewabilityObserver: Error calculating observer root",t.message),null}},t._getParentViewportElement=function(){if(!this.isSameOriginFrame)return null;try{return window.parent.document.documentElement}catch(e){return null}},t._getImmediateParentViewport=function(){if(!this.isSameOriginFrame||!this.frameContext.hasParent)return null;try{var e=window.parent;return e&&e.document?e.document.documentElement:null}catch(e){return null}},t._getFrameAwareViewportDimensions=function(){if("undefined"==typeof window)return{width:0,height:0};try{if(!this.frameContext.isInFrame)return{width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight};if(this.isSameOriginFrame)try{var e=window.parent;return{width:e.innerWidth||e.document.documentElement.clientWidth,height:e.innerHeight||e.document.documentElement.clientHeight}}catch(e){}return{width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight}}catch(e){var t;return null==(t=this.wtCore)||null==t.log||t.log("ViewabilityObserver: Error getting viewport dimensions",e.message),{width:0,height:0}}},t.getViewabilityData=function(e){if(!e||!this.isSupported)return this._getFallbackViewability(e);var t=Date.now(),i=this._getCacheKey(e),n=this.viewabilityCache.get(i);return n&&t-n.timestamp<this.cacheTimeout?(this.metrics.cacheHits++,{percentage:n.percentage,width:n.width,height:n.height}):(this.metrics.cacheMisses++,this._startObserving(e),n?{percentage:n.percentage,width:n.width,height:n.height}:this._getFallbackViewability(e))},t._startObserving=function(e){if(!this.observers.has(e))try{var t,i=this._calculateObserverRoot(),n=Object.assign({},this.observerOptions,{root:i});this.frameContext.isInFrame&&!this.isSameOriginFrame&&(n.threshold=[0,.5,1]);var r=new IntersectionObserver(this.handleIntersection,n);r.observe(e),this.observers.set(e,r),null!=(t=this.wtCore)&&t.debug&&this.wtCore.log("ViewabilityObserver: Started observing element",{frameContext:this.frameContext,isSameOriginFrame:this.isSameOriginFrame,observerRoot:i?"parent-viewport":"current-viewport",thresholds:n.threshold}),this._startResizeObserving(e)}catch(t){var a;null==(a=this.wtCore)||null==a.log||a.log("ViewabilityObserver: Failed to create observer",t.message);try{var s,o=new IntersectionObserver(this.handleIntersection,{root:null,rootMargin:"0px",threshold:[0,.5,1]});o.observe(e),this.observers.set(e,o),null==(s=this.wtCore)||null==s.log||s.log("ViewabilityObserver: Fallback observer created successfully")}catch(e){var l;null==(l=this.wtCore)||null==l.log||l.log("ViewabilityObserver: Both primary and fallback observer creation failed",e.message)}}},t._startResizeObserving=function(e){if(this.resizeObserverSupported&&!this.resizeObservers.has(e))try{var t=new ResizeObserver(this.handleResize);t.observe(e),this.resizeObservers.set(e,t),this._initializeDimensionsCache(e)}catch(e){var i;null==(i=this.wtCore)||null==i.log||i.log("ViewabilityObserver: Failed to create ResizeObserver",e.message)}},t.stopObserving=function(e){var t=this.observers.get(e);t&&(t.unobserve(e),t.disconnect(),this.observers.delete(e));var i=this.resizeObservers.get(e);i&&(i.unobserve(e),i.disconnect(),this.resizeObservers.delete(e));var n=this._getCacheKey(e);this.viewabilityCache.delete(n),this.dimensionsCache.delete(n)},t._handleIntersectionEntries=function(e){var t=this,i=performance.now();e.forEach((function(e){t.metrics.observerCalls++,t._updateViewabilityCache(e.target,e)}));var n=performance.now()-i;this.metrics.totalCalculationTime+=n,this.metrics.avgCalculationTime=this.metrics.totalCalculationTime/this.metrics.observerCalls},t._handleResizeEntries=function(e){var t=this;e.forEach((function(e){t._updateDimensionsCache(e.target,e)}))},t._initializeDimensionsCache=function(e){if(this.resizeObserverSupported){var t=this._getCacheKey(e);this.dimensionsCache.set(t,{width:0,height:0,timestamp:Date.now(),initialized:!1})}},t._updateDimensionsCache=function(e,t){var i=this._getCacheKey(e),n=Date.now(),r=t.contentRect,a=r.width,s=r.height;this.dimensionsCache.set(i,{width:Math.round(a),height:Math.round(s),timestamp:n,initialized:!0})},t._updateViewabilityCache=function(e,t){var i,n,r=this._getCacheKey(e),a=Date.now(),s=Math.round(100*t.intersectionRatio),o=this.dimensionsCache.get(r);if(o&&o.initialized&&this.resizeObserverSupported)i=o.width,n=o.height;else{var l=t.boundingClientRect;i=Math.round(l.width),n=Math.round(l.height),this.resizeObserverSupported||this.dimensionsCache.set(r,{width:i,height:n,timestamp:a,initialized:!0})}this.viewabilityCache.set(r,{percentage:s,width:i,height:n,timestamp:a})},t._getCacheKey=function(e){return e.dataset.wtObserverId||(e.dataset.wtObserverId="wt_"+Date.now()+"_"+Math.random().toString(36).substring(2,11)),e.dataset.wtObserverId},t._getFallbackViewability=function(e){if(!e)return{percentage:0,width:0,height:0};try{var t=e.getBoundingClientRect(),i=Math.round(t.width),n=Math.round(t.height);if(0===i||0===n)return{percentage:0,width:i,height:n};var r=window.getComputedStyle(e,null),a=r.getPropertyValue("visibility"),s=r.getPropertyValue("display");if("hidden"===a||"none"===s)return{percentage:0,width:i,height:n};var o=this._getFrameAwareViewportDimensions(),l=o.width,d=o.height;if(this.frameContext.isInFrame&&!this.isSameOriginFrame)return this._calculateCrossOriginViewability(t,i,n,l,d);var c=Math.max(0,t.left),u=Math.max(0,t.top),h=Math.min(l,t.right),g=Math.min(d,t.bottom);if(c>=h||u>=g)return{percentage:0,width:i,height:n};var w=(h-c)*(g-u),v=i*n;return{percentage:Math.round(w/v*100),width:i,height:n}}catch(e){var m;return null==(m=this.wtCore)||null==m.log||m.log("ViewabilityObserver: Fallback calculation failed",e.message),{percentage:0,width:0,height:0}}},t._calculateCrossOriginViewability=function(e,t,i,n,r){var a=Math.max(0,e.left),s=Math.max(0,e.top),o=Math.min(n,e.right),l=Math.min(r,e.bottom);if(a>=o||s>=l)return{percentage:0,width:t,height:i};var d=(o-a)*(l-s),c=t*i,u=Math.round(d/c*100);return this.frameContext.crossOriginBlocked&&(u=Math.min(u,75)),{percentage:u,width:t,height:i,crossOriginLimited:!0}},t._throttle=function(e,t){var i,n=0;return function(){for(var r=this,a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];var l=Date.now();l-n>t?(e.apply(this,s),n=l):(clearTimeout(i),i=setTimeout((function(){e.apply(r,s),n=Date.now()}),t-(l-n)))}},t.clearStaleCache=function(e){void 0===e&&(e=5e3);for(var t,i=Date.now(),n=r(this.viewabilityCache.entries());!(t=n()).done;){var a=t.value,s=a[0];i-a[1].timestamp>e&&this.viewabilityCache.delete(s)}for(var o,l=r(this.dimensionsCache.entries());!(o=l()).done;){var d=o.value,c=d[0];i-d[1].timestamp>e&&this.dimensionsCache.delete(c)}},t.getMetrics=function(){return Object.assign({},this.metrics,{cacheSize:this.viewabilityCache.size,dimensionsCacheSize:this.dimensionsCache.size,observersCount:this.observers.size,resizeObserversCount:this.resizeObservers.size,isSupported:this.isSupported,resizeObserverSupported:this.resizeObserverSupported,frameContext:Object.assign({},this.frameContext,{isSameOriginFrame:this.isSameOriginFrame,isNestedFrame:this.isNestedFrame,viewportStrategy:this._getViewportStrategy()})})},t._getViewportStrategy=function(){return this.frameContext.isInFrame?this.isSameOriginFrame?this.isNestedFrame?"nested-same-origin":"same-origin-parent":"cross-origin-limited":"top-level-viewport"},t.resetMetrics=function(){this.metrics={observerCalls:0,cacheHits:0,cacheMisses:0,avgCalculationTime:0,totalCalculationTime:0}},t.updateFrameContext=function(){var e;return this.frameContext=this._detectFrameContext(),this.isSameOriginFrame=this._detectSameOriginFrame(),this.isNestedFrame=this._detectNestedFrame(),null!=(e=this.wtCore)&&e.debug&&this.wtCore.log("ViewabilityObserver: Frame context updated",{frameContext:this.frameContext,isSameOriginFrame:this.isSameOriginFrame,isNestedFrame:this.isNestedFrame}),{frameContext:this.frameContext,isSameOriginFrame:this.isSameOriginFrame,isNestedFrame:this.isNestedFrame}},t.destroy=function(){for(var e,t=r(this.observers.values());!(e=t()).done;){var i=e.value;try{i.disconnect()}catch(e){}}for(var n,a=r(this.resizeObservers.values());!(n=a()).done;){var s=n.value;try{s.disconnect()}catch(e){}}this.observers.clear(),this.resizeObservers.clear(),this.viewabilityCache.clear(),this.dimensionsCache.clear(),"undefined"!=typeof window&&window.removeEventListener("beforeunload",this.destroy.bind(this))},e}(),b=function(){function e(e,t){var i,n=this;this.options={debug:!1,sendAllCustom:!1,viewability:{useIntersectionObserver:"auto",updateThrottle:200,cacheTimeout:1e3,legacyThrottle:100,forceLegacyMode:!1}},this.sessionId=void 0,this.loopIdx=0,this.staticData={},this.sessionFlags={},this.env={},this.stream=void 0,this.viewabilityObserver=void 0,this.createGuid=function(){for(var e="",t=0;t<12;t++)e+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXZY01234567890".charAt(Math.floor(64*Math.random()));return Date.now()+"-"+e},this.destroy=function(){n.viewabilityObserver&&(n.viewabilityObserver.destroy(),n.viewabilityObserver=null),n.legacyViewabilityCache&&(n.legacyViewabilityCache.clear(),n.legacyViewabilityCache=null),n.log("WTCore destroyed")},this.createSession=function(){var e,t,i=!1;try{i=!!window.top.innerWidth||!!window.top.document.documentElement.clientWidth||!!window.top.document.body.clientWidth}catch(e){}n.sessionFlags={firstTimeDataSent:!1,isFif:i,sessionStartTime:Date.now()},n.sessionId=n.createGuid(),0===n.loopIdx&&(n.playlistId=n.createGuid()),n.loopIdx+=1;var r=function(){var e,t;try{var i=S(window.top);e=i[0],t=i[1]}catch(e){}if(!e){var n=window,r=S(n);e=r[0],t=r[1];try{for(;n.parent&&n!==n.parent;){var a=S(n.parent);e=a[0],t=a[1],n=n.parent}}catch(e){}}return[e,t]}();return n.sessionFlags.ww=r[0],n.sessionFlags.wh=r[1],n.sessionFlags.pu=function(e){var t=document.referrer;!t&&e&&(t=document.documentURI);try{var i;(window.location===window.parent.location||!t&&null!=(i=document)&&null!=(i=i.location)&&i.href)&&(t=document.location.href)}catch(e){}return t}(i),n.staticData={rid:n.sessionId,idx:(null==(e=n.env)||null==e.getIdx?void 0:e.getIdx())||n.loopIdx,plGid:n.playlistId,src:n.options.src,v:n.options.v,plV:null==(t=n.env)||null==t.getPlayerVersion?void 0:t.getPlayerVersion(),fif:+n.sessionFlags.isFif,domain:_(n.sessionFlags.pu)},n.sessionId},this.stopObservingElement=function(e){n.viewabilityObserver&&e&&n.viewabilityObserver.stopObserving(e)},this.getViewabilityMetrics=function(){var e={strategy:n.viewabilityStrategy,features:n.viewabilityFeatures,config:n.options.viewability};return n.viewabilityObserver?Object.assign({},e,{observer:n.viewabilityObserver.getMetrics()}):n.legacyViewabilityCache?Object.assign({},e,{legacy:{cacheSize:n.legacyViewabilityCache.size,throttleMs:n.legacyThrottle,lastUpdate:n.legacyLastUpdate}}):e},this.setForceLegacyMode=function(e){void 0===e&&(e=!0),n.options.viewability.forceLegacyMode=e,n.log("Force legacy mode set to:",e),n.viewabilityObserver&&(n.viewabilityObserver.destroy(),n.viewabilityObserver=null),n._initializeViewabilitySystem()},this.getViewabilityConfig=function(){return{strategy:n.viewabilityStrategy,features:n.viewabilityFeatures,config:n.options.viewability,hasObserver:!!n.viewabilityObserver,hasLegacyFallback:!!n.legacyViewabilityCache}},this.sendData=function(e){n.stream.push(n.gatherData(e))},this.gatherData=function(e){var t,i,r;void 0===e&&(e={});var a,s=Object.assign({},e,n.staticData,{mediaId:null==(t=n.env)||null==t.getMediaId?void 0:t.getMediaId(),playerId:null==(i=n.env)||null==i.getPlayerId?void 0:i.getPlayerId(),cst:Date.now()-n.sessionFlags.sessionStartTime,pVisible:F(),isLive:null==(r=n.env)||null==r.getIsLive?void 0:r.getIsLive()});n.sessionFlags.firstTimeDataSent||(n.sessionFlags.firstTimeDataSent=!0,s.cst=0,s.ww=n.sessionFlags.ww,s.wh=n.sessionFlags.wh,s.pu=n.sessionFlags.pu);try{var o=n.env.getVideoSlot();if(o)if("modern"===n.viewabilityStrategy&&n.viewabilityObserver){var l,d,c=n.viewabilityObserver.getViewabilityData(o);s.per=null!=(l=null==(d=n.env)||null==d.getPercentViewable?void 0:d.getPercentViewable())?l:c.percentage,s.w=c.width,s.h=c.height}else{var u,h,g=n.getLegacyViewabilityThrottled(o);s.per=null!=(u=null==(h=n.env)||null==h.getPercentViewable?void 0:h.getPercentViewable())?u:g.percentage,s.w=g.width,s.h=g.height}}catch(e){n.log("gatherData ERROR reading ad WxH:",e.message)}try{var w=O(window,["wtatCustom","fields"],{});Object.keys(w).length&&(s.custom=s.custom||{},Object.entries(w).forEach((function(e){var t=e[0],i=e[1];"function"==typeof i?s.custom[t]=i(s):!n.options.sendAllCustom&&n.sessionFlags.staticCustomSent||(s.custom[t]=i)}))),n.sessionFlags.staticCustomSent=!0}catch(e){n.log("gatherData error",e.message)}if(a=s,!O(window,["wtatCustom","ignoredEvents"],[]).some((function(e){return Object.entries(e).every((function(e){var t=e[0],i=e[1];return O(a,t)===i}))})))return s},this.logger=function(e){return function(){if(n.options.debug)try{for(var t,i,r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];console.warn.apply(null,["%c"+e+" "+(null!=(t=null==(i=n.env)||null==i.getPlayerId?void 0:i.getPlayerId())?t:""),"background:#ffd400;color:#000;padding:2px"].concat(a))}catch(e){}}},this.options=Object.assign(this.options,e),this.env=t;var r={debug:this.options.debug,apiKey:this.options.apiKey};this.options.wtUrl&&(r.endpoint=this.options.wtUrl),window&&window.wtStream?this.stream=window.wtStream:(this.stream=new p(r),window&&(window.wtStream=this.stream)),this.log=this.logger("WTAT.core",this.options.debug,null==(i=this.env)||null==i.getPlayerId?void 0:i.getPlayerId()),this.log("version",this.options.v),this._initializeViewabilitySystem()}var t=e.prototype;return t._initializeViewabilitySystem=function(){this.viewabilityFeatures=this._detectViewabilityFeatures(),this.viewabilityStrategy=this._determineViewabilityStrategy(),this.log("Viewability system initialized",{features:this.viewabilityFeatures,strategy:this.viewabilityStrategy,config:this.options.viewability}),"modern"===this.viewabilityStrategy?this.viewabilityObserver=new f(this):(this.viewabilityObserver=null,this._initializeLegacyFallback())},t._detectViewabilityFeatures=function(){if("undefined"==typeof window)return{intersectionObserver:!1,resizeObserver:!1,weakMap:!1,performance:!1,supported:!1};var e={intersectionObserver:"IntersectionObserver"in window,resizeObserver:"ResizeObserver"in window,weakMap:"WeakMap"in window,performance:"performance"in window&&"function"==typeof window.performance.now,getBoundingClientRect:!0};return e.supported=e.intersectionObserver&&e.weakMap,e},t._determineViewabilityStrategy=function(){if(this.options.viewability.forceLegacyMode)return this.log("Forced legacy mode enabled"),"legacy";var e=this.options.viewability.useIntersectionObserver;return"disabled"===e?(this.log("IntersectionObserver disabled by configuration"),"legacy"):"enabled"===e?this.viewabilityFeatures.supported?(this.log("IntersectionObserver enabled by configuration"),"modern"):(this.log("IntersectionObserver enabled but not supported, falling back to legacy"),"legacy"):this.viewabilityFeatures.supported?(this.log("Auto-detected IntersectionObserver support, using modern strategy"),"modern"):(this.log("IntersectionObserver not supported, using legacy strategy"),"legacy")},t._initializeLegacyFallback=function(){this.legacyViewabilityCache=new Map,this.legacyLastUpdate=0,this.legacyThrottle=this.options.viewability.legacyThrottle,this.getLegacyViewabilityThrottled=this._throttleLegacyViewability(this._calculateLegacyViewability.bind(this),this.legacyThrottle),this.log("Legacy fallback system initialized with throttling:",this.legacyThrottle+"ms")},t._throttleLegacyViewability=function(e,t){var i,n=this,r=0;return function(a){var s=Date.now(),o=n._getLegacyCacheKey(a),l=n.legacyViewabilityCache.get(o);if(l&&s-l.timestamp<n.options.viewability.cacheTimeout)return l.data;if(s-r>t){var d=e(a);return r=s,n.legacyLastUpdate=s,n.legacyViewabilityCache.set(o,{data:d,timestamp:s}),d}return l?l.data:(clearTimeout(i),i=setTimeout((function(){var t=e(a);r=Date.now(),n.legacyLastUpdate=Date.now(),n.legacyViewabilityCache.set(o,{data:t,timestamp:Date.now()})}),t-(s-r)),e(a))}},t._getLegacyCacheKey=function(e){return e.dataset.wtLegacyId||(e.dataset.wtLegacyId="legacy_"+Date.now()+"_"+Math.random().toString(36).substring(2,11)),e.dataset.wtLegacyId},t._calculateLegacyViewability=function(e){if(!e)return{percentage:0,width:0,height:0};try{var t,i=e.getBoundingClientRect(),n=Math.round(i.width),r=Math.round(i.height);if(0===n||0===r)return{percentage:0,width:n,height:r};var a=window.getComputedStyle(e,null),s=a.getPropertyValue("visibility"),o=a.getPropertyValue("display");if("hidden"===s||"none"===o)return{percentage:0,width:n,height:r};var l=null==(t=this.sessionFlags)?void 0:t.isFif;if(void 0===l)try{l=!!window.top.innerWidth||!!window.top.document.documentElement.clientWidth}catch(e){l=!1}return{percentage:this._calculateOptimizedViewability(e,i,l),width:n,height:r}}catch(e){return this.log("Legacy viewability calculation failed:",e.message),{percentage:0,width:0,height:0}}},t._calculateOptimizedViewability=function(e,t,i){try{if(i){var n=this._getOptimizedViewportSize();if(!n.width||!n.height)return 0;var r=this._getOptimizedElementPosition(e,t);return this._calculateViewabilityPercentage(t,r,n)}var a={width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight},s={left:t.left,top:t.top,right:t.right,bottom:t.bottom},o=this._calculateViewabilityPercentage(t,s,a);return Math.min(o,75)}catch(e){return this.log("Optimized viewability calculation error:",e.message),0}},t._getOptimizedViewportSize=function(){var e=Date.now();if(this._viewportCache&&e-this._viewportCache.timestamp<1e3)return this._viewportCache.size;try{var t=S(window.top);return this._viewportCache={size:{width:t[0],height:t[1]},timestamp:e},this._viewportCache.size}catch(e){var i=S(window);return{width:i[0],height:i[1]}}},t._getOptimizedElementPosition=function(e,t){try{return C(e,window)}catch(e){return{left:t.left,top:t.top,right:t.right,bottom:t.bottom}}},t._calculateViewabilityPercentage=function(e,t,i){var n=0;n=t.right<0||t.left>i.width?0:t.left<i.width&&t.right>i.width?(i.width-t.left)/e.width*100:t.left<0&&t.right>0?t.right/e.width*100:100;var r=0;return r=t.bottom<0||t.top>i.height?0:t.top<i.height&&t.bottom>i.height?(i.height-t.top)/e.height*100:t.top<0&&t.bottom>0?t.bottom/e.height*100:100,Math.round(n*r/100)},e}();function O(e,t,i){if(!e)return i;for(var n,a=e,s=r(Array.isArray(t)?t:t.split("."));!(n=s()).done;){var o=n.value;if(void 0===a[o])return i;a=a[o]}return a}function F(){return void 0!==document.visibilityState?Number("visible"===document.visibilityState):void 0!==document.hidden?Number(!document.hidden):void 0}function C(e,t){var i=t,n=t.parent,r={left:0,right:0,top:0,bottom:0};if(e){var a=e.getBoundingClientRect();i!==n&&(r=C(i.frameElement,n)),r={left:a.left+r.left,right:a.right+r.left,top:a.top+r.top,bottom:a.bottom+r.top}}return r}function S(e){var t=1/0,i=1/0;return!isNaN(e.document.body.clientWidth)&&e.document.body.clientWidth>0&&(t=e.document.body.clientWidth),!isNaN(e.document.body.clientHeight)&&e.document.body.clientHeight>0&&(i=e.document.body.clientHeight),e.document.documentElement&&e.document.documentElement.clientWidth&&!isNaN(e.document.documentElement.clientWidth)&&(t=e.document.documentElement.clientWidth),e.document.documentElement&&e.document.documentElement.clientHeight&&!isNaN(e.document.documentElement.clientHeight)&&(i=e.document.documentElement.clientHeight),e.innerWidth&&!isNaN(e.innerWidth)&&(t=Math.min(t,e.innerWidth)),e.innerHeight&&!isNaN(e.innerHeight)&&(i=Math.min(i,e.innerHeight)),[t,i]}function _(e){if(e)try{return new URL(e).hostname}catch(e){}}var E=["loaded","start","impression","firstQuartile","midpoint","thirdQuartile","complete","adError","log","click","volumeChange","mute","unmute"],k=n("getEventData"),V=function(e){function i(i,n){var a;if(void 0===n&&(n={}),(a=e.call(this)||this).player=void 0,a.options=void 0,a.sessionFlags={likelyBreak:0,likelyBreakPos:0},a.log=function(){},a.utils=void 0,a.SHORT_NAME="jw-ima",a._getAdDetails=function(e){if(e)return{adId:e.getAdId(),adSys:e.getAdSystem(),adAN:e.getAdvertiserName(),adDID:e.getDealId(),adWId:e.getWrapperAdIds(),adWSys:e.getWrapperAdSystems(),adMU:e.getMediaUrl(),adCId:e.getCreativeId(),adWCId:e.getWrapperCreativeIds()}},a._getAdPod=function(e,t){void 0===t&&(t=!1);var i={adMgV:a.getAdMgV()},n=null==e||null==e.getAdPodInfo?void 0:e.getAdPodInfo();if(n){try{var r;i.adBreak=null!=(r=null==n||null==n.getPodIndex?void 0:n.getPodIndex())?r:0,a.sessionFlags.likelyBreak=i.adBreak}catch(e){i.adBreak=t?a.sessionFlags.likelyBreak:0}try{var s;i.adBreakPos=(null!=(s=null==n||null==n.getAdPosition?void 0:n.getAdPosition())?s:1)-1,a.sessionFlags.likelyBreakPos=i.adBreakPos}catch(e){i.adBreakPos=t?a.sessionFlags.likelyBreakPos:0}i.adGid=a.utils.sessionId+"-"+i.adBreak+"-"+i.adBreakPos;try{var o=null==n||null==n.getTotalAds?void 0:n.getTotalAds();a.sessionFlags.totalAds||(a.sessionFlags.totalAds={}),a.sessionFlags.totalAds[i.adBreak]=o}catch(e){}}else t&&(i.adBreak=a.sessionFlags.likelyBreak,i.adBreakPos=a.sessionFlags.likelyBreakPos,i.adGid=a.utils.sessionId+"-"+i.adBreak+"-"+i.adBreakPos);return i},a._adError=function(e,t){var i,n={type:"error"};return e&&("string"==typeof e?n.err=e:(n.st=null==e||null==e.getType?void 0:e.getType(),n.err=null==e||null==e.getVastErrorCode?void 0:e.getVastErrorCode(),n.err2=null==e||null==e.getErrorCode?void 0:e.getErrorCode())),Object.assign(n,a._getAdPod(t,!0)),null!=(i=a.sessionFlags)&&null!=(i=i.totalAds)&&i[a.sessionFlags.likelyBreak]?a.sessionFlags.likelyBreakPos<a.sessionFlags.totalAds[a.sessionFlags.likelyBreak]-1?a.sessionFlags.likelyBreakPos++:(a.sessionFlags.likelyBreak++,a.sessionFlags.likelyBreakPos=0):a.sessionFlags.likelyBreakPos++,n},a.PLAYER_EVENTS={ready:function(e){return{type:"ready",custom:{ttReady:e.setupTime}}},playlistItem:function(){return a.sessionFlags.resetOnInit&&a.resetState(),a.sessionFlags.resetOnInit=!0,{type:"init",aBl:a.getAdBlock()}},adsManager:function(e){var t=function(e){a.player.trigger("wtat-"+e.type,{originalEvent:e})};E.forEach((function(i){e.adsManager.addEventListener(i,t)}))},adBreakStart:function(){var e;a.sessionFlags.duringAd=!0,a.sessionFlags.likelyBreak>0&&(null==(e=a.sessionFlags.podEndedRanFor)||!e.includes(a.sessionFlags.likelyBreak-1))&&a.sessionFlags.likelyBreak++,a.sessionFlags.likelyBreakPos=0},adBreakEnd:function(){delete a.sessionFlags.duringAd,a.sessionFlags.podEndedRanFor||(a.sessionFlags.podEndedRanFor=[]),a.sessionFlags.podEndedRanFor.push(a.sessionFlags.likelyBreak),a.sessionFlags.likelyBreak++,a.sessionFlags.likelyBreakPos=0},adRequest:function(e){return{type:"serve",adURL:e.tag,adMgV:a.getAdMgV()}},"wtat-loaded":function(e){var t={type:"al"},i=e.originalEvent.getAd();return Object.assign(t,a._getAdPod(i)),t},"wtat-start":function(e){var t={type:"sa"},i=e.originalEvent.getAd();return Object.assign(t,a._getAdDetails(i)),Object.assign(t,a._getAdPod(i)),t},"wtat-impression":function(e){var t={type:"imp"},i=e.originalEvent.getAd();return Object.assign(t,a._getAdPod(i)),t},"wtat-firstQuartile":function(e){var t={type:"efq"},i=e.originalEvent.getAd();return Object.assign(t,a._getAdPod(i)),t},"wtat-midpoint":function(e){var t={type:"esq"},i=e.originalEvent.getAd();return Object.assign(t,a._getAdPod(i)),t},"wtat-thirdQuartile":function(e){var t={type:"etq"},i=e.originalEvent.getAd();return Object.assign(t,a._getAdPod(i)),t},"wtat-complete":function(e){var t={type:"ecp"},i=e.originalEvent.getAd();Object.assign(t,a._getAdPod(i));var n=null==i||null==i.getAdPodInfo?void 0:i.getAdPodInfo();return n&&(n.getAdPosition()<n.getTotalAds()?a.sessionFlags.likelyBreakPos++:(a.sessionFlags.likelyBreak++,a.sessionFlags.likelyBreakPos=0)),t},"wtat-mute":function(e){var t={type:"mute"},i=e.originalEvent.getAd();return Object.assign(t,a._getAdPod(i)),t},"wtat-unmute":function(e){var t={type:"unmute"},i=e.originalEvent.getAd();return Object.assign(t,a._getAdPod(i)),t},"wtat-click":function(e){var t={type:"adClick"},i=e.originalEvent.getAd();return Object.assign(t,a._getAdPod(i)),t},"wtat-adError":function(e){return{type:"wtat-adError",debug:JSON.stringify(Object.keys(e.originalEvent))}},"wtat-log":function(e){var t;return a._adError(null==(t=e.originalEvent)||null==t.getAdData||null==(t=t.getAdData())?void 0:t.adError,e.originalEvent.getAd())},adError:function(e){if(!e.ima)return Object.assign({type:"error",err:e.code,err2:e.adErrorCode},a._adError())},beforePlay:function(e){if(!a.sessionFlags.playSent){a.sessionFlags.playSent=!0;var t={type:"play",autoplay:!1};return"autostart"===e.playReason&&(t.autoplay=!0),t}},firstFrame:function(e){var t=e.loadTime;return a.sessionFlags.c0Sent=!0,{type:"c0",custom:{ttFF:t}}},time:function(e){if(a.sessionFlags.c0Sent){var t=Math.floor(100*e.position/e.duration);if(!a.sessionFlags.c95Sent&&t>=95)return a.sessionFlags.c95Sent=!0,a.sessionFlags.c75Sent=!0,a.sessionFlags.c50Sent=!0,a.sessionFlags.c25Sent=!0,{type:"c95"};if(!a.sessionFlags.c75Sent&&t>=75)return a.sessionFlags.c75Sent=!0,a.sessionFlags.c50Sent=!0,a.sessionFlags.c25Sent=!0,{type:"c75"};if(!a.sessionFlags.c50Sent&&t>=50)return a.sessionFlags.c50Sent=!0,a.sessionFlags.c25Sent=!0,{type:"c50"};if(!a.sessionFlags.c25Sent&&t>=25)return a.sessionFlags.c25Sent=!0,{type:"c25"}}}},a.start=function(){a.utils=new b(a.options,a),a.log=a.utils.logger("WTAT."+a.SHORT_NAME),a.resetState();for(var e=0,t=Object.entries(O(window,["wtatCustom","events"],{}));e<t.length;e++){var i=t[e],n=i[0],r=i[1];a.PLAYER_EVENTS[n]?a.PLAYER_EVENTS[n]=[a.PLAYER_EVENTS[n],r]:a.PLAYER_EVENTS[n]=r}Object.keys(a.PLAYER_EVENTS).forEach((function(e){a.player.on(e,a._onPlayerEvent)}))},a.resetState=function(){a.log("resetting state"),a.sessionFlags={likelyBreak:0,likelyBreakPos:0},a.utils.createSession()},Object.defineProperty(a,k,{writable:!0,value:function(e,i){var n;if("function"==typeof e)try{n=e(i)}catch(e){a.log("Error executing event listener for",i.type,e.message)}else if(!0===e)n={type:i.type};else if(Array.isArray(e)){n=[];for(var s,o=r(e);!(s=o()).done;){var l=s.value;n.push(t(a,k)[k](l,i))}}else n=e;return n}}),a._onPlayerEvent=function(e){if(a.PLAYER_EVENTS[e.type]){var i=t(a,k)[k](a.PLAYER_EVENTS[e.type],e);Array.isArray(i)&&(i=Object.assign.apply(Object,i)),i&&(i.type?a.utils.sendData(i):a.log("Encountered an event without a type. Not sending",e.type,i))}else a.log("Untracked player event triggered",e.type,e)},a.getVideoSlot=function(){return a.player.getContainer()},a.getMediaId=function(){var e;return null==(e=a.player.getPlaylistItem())?void 0:e.mediaid},a.getPlayerId=function(){return a.player.getConfig().pid},a.getPlayerVersion=function(){if(!a.sessionFlags.plV){var e=a.player.version.split(/\W/);a.sessionFlags.plV=e[0]+"."+e[1]+"."+e[2]}return a.sessionFlags.plV},a.getAdBlock=function(){return+a.player.getAdBlock()},a.getAdMgV=function(){var e;return null==(e=google)||null==(e=e.ima)?void 0:e.VERSION},a.getPercentViewable=function(){return 100*a.player.getPercentViewable()},a.getIsLive=function(){return Number(a.player.getDuration()===1/0)},a.player=i,a.options=n,a.options.src=a.SHORT_NAME,"debug"===a.options.debug)debugger;return a}var n,s;return s=e,(n=i).prototype=Object.create(s.prototype),n.prototype.constructor=n,a(n,s),i}(o),I={v:"5.9.0"},A={};try{var P=localStorage.getItem("wtDebug"),M=localStorage.getItem("wtUrl");P&&(A.debug=P),M&&(A.wtUrl=M)}catch(e){}function T(e,t){var i=Object.assign({},I,t,A);i.wtatCustom&&(window.wtatCustom=window.wtatCustom||{},i.wtatCustom.fields&&(window.wtatCustom.fields=Object.assign({},window.wtatCustom.fields||{},i.wtatCustom.fields)),i.wtatCustom.events&&(window.wtatCustom.events=Object.assign({},window.wtatCustom.events||{},i.wtatCustom.events)),i.wtatCustom.ignoredEvents&&(window.wtatCustom.ignoredEvents=[].concat(window.wtatCustom.ignoredEvents||[],i.wtatCustom.ignoredEvents)),delete i.wtatCustom);var n=new V(e,i);e.wtAdTracer=n,n.start()}var z;return!(z=window.jwplayerPluginJsonp)&&"function"==typeof window.jwplayer&&window.jwplayer().registerPlugin&&(z=window.jwplayer().registerPlugin),z&&z("us.wtat.plugin-jw_ima.min","8.17.0",(function(e,t){void 0===t&&(t={}),T(e,t)})),function(e,t,i){var n;void 0===e&&(e={}),void 0===i&&(i=!1),t?"string"==typeof t?n=jwplayer(t):"object"==typeof t&&t.id?n=jwplayer(t.id):t.on&&(n=t):n=jwplayer(),i?T(n,e):n.on("ready",(function(){return T(n,e)}))}}();
