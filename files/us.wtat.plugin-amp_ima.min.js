var wtAdTracer=function(){"use strict";function e(t,n){return(e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(t,n)}function t(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var s=0;return function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=0;function i(e){return"__private_"+s+++"_"+e}function o(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var r,l=function(){function e(){this.player=void 0,this.utils=void 0,this.SHORT_NAME="Must be implemented",this.PLAYER_EVENTS={}}var t=e.prototype;return t.start=function(){},t.getVideoSlot=function(){},t.getMediaId=function(){},t.getPlayerId=function(){},t.getPlayerVersion=function(){},t.getAdBlock=function(){},t.getAdMgV=function(){},t.getIdx=function(){},t.getPercentViewable=function(){},t.getIsLive=function(){},e}(),d={endpoint:"https://us.q2s15.com/v5/in",batchSize:5,batchInterval:1e3,debug:!1},u={0:[]},c=0,g=!1,p=!1,v=function(){if(d.debug)try{for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.warn.apply(null,["%cWTAT.stream","background:#ffd400;color:#000;padding:2px"].concat(t))}catch(e){}};function f(){d.batchInterval>0&&(r=setInterval(m,d.batchInterval))}function y(){clearInterval(r)}function m(){if(!g){g=!0,y();var e=c;u[c+1]=[],c++,u[e].length&&function(e,t){v("sending",e);try{var n=JSON.stringify(e);if(navigator.sendBeacon){var a=new FormData;a.append("batch",n),a.append("apiKey",d.apiKey),navigator.sendBeacon(d.endpoint,a)||v("beacon queue error"),h(t)}else{var s=new XMLHttpRequest;s.open("POST",d.endpoint,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.setRequestHeader("x-api-key",d.apiKey),s.setRequestHeader("Connection","keep-alive"),s.onreadystatechange=function(){h(t)},s.send("batch="+encodeURIComponent(n))}}catch(e){v("xhr error",e.message)}}(u[e],e),g=!1,f()}}function h(e){delete u[e]}var w=function(){function e(e){void 0===e&&(e={}),d=Object.assign(d,e),f()}var t=e.prototype;return t.push=function(e){!p&&e&&(v("received",e),u[c].push(e),u[c].length>=d.batchSize&&m())},t.stop=function(){p=!0,u[c].length&&m(),y()},e}(),b=function(e,t){var n,a=this;this.options={debug:!1,sendAllCustom:!1},this.sessionId=void 0,this.loopIdx=0,this.staticData={},this.sessionFlags={},this.env={},this.stream=void 0,this.createGuid=function(){for(var e="",t=0;t<12;t++)e+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXZY01234567890".charAt(Math.floor(64*Math.random()));return Date.now()+"-"+e},this.createSession=function(){var e,t,n=!1;try{n=!!window.top.innerWidth||!!window.top.document.documentElement.clientWidth||!!window.top.document.body.clientWidth}catch(e){}a.sessionFlags={firstTimeDataSent:!1,isFif:n,sessionStartTime:Date.now()},a.sessionId=a.createGuid(),0===a.loopIdx&&(a.playlistId=a.createGuid()),a.loopIdx+=1;var s=function(){var e,t;try{var n=E(window.top);e=n[0],t=n[1]}catch(e){}if(!e){var a=window,s=E(a);e=s[0],t=s[1];try{for(;a.parent&&a!==a.parent;){var i=E(a.parent);e=i[0],t=i[1],a=a.parent}}catch(e){}}return[e,t]}();return a.sessionFlags.ww=s[0],a.sessionFlags.wh=s[1],a.sessionFlags.pu=function(e){var t=document.referrer;!t&&e&&(t=document.documentURI);try{var n,a;(window.location===window.parent.location||!t&&null!=(n=document)&&null!=(a=n.location)&&a.href)&&(t=document.location.href)}catch(e){}return t}(n),a.staticData={rid:a.sessionId,idx:(null==(e=a.env)||null==e.getIdx?void 0:e.getIdx())||a.loopIdx,plGid:a.playlistId,src:a.options.src,v:a.options.v,plV:null==(t=a.env)||null==t.getPlayerVersion?void 0:t.getPlayerVersion(),fif:+a.sessionFlags.isFif,domain:P(a.sessionFlags.pu)},a.sessionId},this.sendData=function(e){a.stream.push(a.gatherData(e))},this.gatherData=function(e){var t,n,s;void 0===e&&(e={});var i,o=Object.assign({},e,a.staticData,{mediaId:null==(t=a.env)||null==t.getMediaId?void 0:t.getMediaId(),playerId:null==(n=a.env)||null==n.getPlayerId?void 0:n.getPlayerId(),cst:Date.now()-a.sessionFlags.sessionStartTime,pVisible:F(),isLive:null==(s=a.env)||null==s.getIsLive?void 0:s.getIsLive()});a.sessionFlags.firstTimeDataSent||(a.sessionFlags.firstTimeDataSent=!0,o.cst=0,o.ww=a.sessionFlags.ww,o.wh=a.sessionFlags.wh,o.pu=a.sessionFlags.pu);try{var r=a.env.getVideoSlot();if(r){var l,d;o.per=null!=(l=null==(d=a.env)||null==d.getPercentViewable?void 0:d.getPercentViewable())?l:function(e,t){if(!e)return;try{var n=window.getComputedStyle(e,null),a=n.getPropertyValue("visibility"),s=n.getPropertyValue("display");if("hidden"===a||"none"===s)return 0;try{if(t){var i=E(window.top),o=i[0],r=i[1],l=e.getBoundingClientRect(),d=0,u=0;if(o===1/0||r===1/0)return;var c=A(e,window);try{d=c.bottom<0||c.top>r?0:c.top<r&&c.bottom>r?(r-c.top)/l.height*100:c.top<0&&c.bottom>0?c.bottom/l.height*100:100,u=c.right<0||c.left>o?0:c.left<o&&c.right>o?(o-c.left)/l.width*100:c.left<0&&c.right>0?c.right/l.width*100:100}catch(e){return}return parseInt(u*d/100,10)}}catch(e){}}catch(e){}}(r,a.sessionFlags.isFif);var u=r.getBoundingClientRect();o.w=parseInt(u.width,10),o.h=parseInt(u.height,10)}}catch(e){a.log("gatherData ERROR reading ad WxH:",e.message)}try{var c=k(window,["wtatCustom","fields"],{});Object.keys(c).length&&(o.custom=o.custom||{},Object.entries(c).forEach((function(e){var t=e[0],n=e[1];"function"==typeof n?o.custom[t]=n(o):!a.options.sendAllCustom&&a.sessionFlags.staticCustomSent||(o.custom[t]=n)}))),a.sessionFlags.staticCustomSent=!0}catch(e){a.log("gatherData error",e.message)}if(i=o,!k(window,["wtatCustom","ignoredEvents"],[]).some((function(e){return Object.entries(e).every((function(e){var t=e[0],n=e[1];return k(i,t)===n}))})))return o},this.logger=function(e){return function(){if(a.options.debug)try{for(var t,n,s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];console.warn.apply(null,["%c"+e+" "+(null!=(t=null==(n=a.env)||null==n.getPlayerId?void 0:n.getPlayerId())?t:""),"background:#ffd400;color:#000;padding:2px"].concat(i))}catch(e){}}},this.options=Object.assign(this.options,e),this.env=t;var s={debug:this.options.debug,apiKey:this.options.apiKey};this.options.wtUrl&&(s.endpoint=this.options.wtUrl),window&&window.wtStream?this.stream=window.wtStream:(this.stream=new w(s),window&&(window.wtStream=this.stream)),this.log=this.logger("WTAT.core",this.options.debug,null==(n=this.env)||null==n.getPlayerId?void 0:n.getPlayerId()),this.log("version",this.options.v)};function k(e,t,n){if(!e)return n;for(var s,i=e,o=a(Array.isArray(t)?t:t.split("."));!(s=o()).done;){var r=s.value;if(void 0===i[r])return n;i=i[r]}return i}function F(){return void 0!==document.visibilityState?Number("visible"===document.visibilityState):void 0!==document.hidden?Number(!document.hidden):void 0}function A(e,t){var n=t,a=t.parent,s={left:0,right:0,top:0,bottom:0};if(e){var i=e.getBoundingClientRect();n!==a&&(s=A(n.frameElement,a)),s={left:i.left+s.left,right:i.right+s.left,top:i.top+s.top,bottom:i.bottom+s.top}}return s}function E(e){var t=1/0,n=1/0;return!isNaN(e.document.body.clientWidth)&&e.document.body.clientWidth>0&&(t=e.document.body.clientWidth),!isNaN(e.document.body.clientHeight)&&e.document.body.clientHeight>0&&(n=e.document.body.clientHeight),e.document.documentElement&&e.document.documentElement.clientWidth&&!isNaN(e.document.documentElement.clientWidth)&&(t=e.document.documentElement.clientWidth),e.document.documentElement&&e.document.documentElement.clientHeight&&!isNaN(e.document.documentElement.clientHeight)&&(n=e.document.documentElement.clientHeight),e.innerWidth&&!isNaN(e.innerWidth)&&(t=Math.min(t,e.innerWidth)),e.innerHeight&&!isNaN(e.innerHeight)&&(n=Math.min(n,e.innerHeight)),[t,n]}function P(e){if(e)try{return new URL(e).hostname}catch(e){}}var I=i("getEventData"),S=function(n){var s,i;function r(e,s){var i;if(void 0===s&&(s={}),(i=n.call(this)||this).player=void 0,i.options=void 0,i.sessionFlags={likelyBreak:0,likelyBreakPos:0},i.log=function(){},i.utils=void 0,i.SHORT_NAME="akp",i._getAdDetails=function(e){if(e)return{adId:e.getAdId(),adSys:e.getAdSystem(),adAN:e.getAdvertiserName(),adDID:e.getDealId(),adWId:e.getWrapperAdIds(),adWSys:e.getWrapperAdSystems(),adMU:e.getMediaUrl(),adCId:e.getCreativeId(),adWCId:e.getWrapperCreativeIds()}},i._getAdPod=function(e,t){void 0===t&&(t=!1);var n={adMgV:i.getAdMgV()},a=null==e||null==e.getAdPodInfo?void 0:e.getAdPodInfo();if(a){var s,o;if(i.getIsLive())i.sessionFlags.likelyBreak=null!=(s=null==(o=i.sessionFlags)?void 0:o.serveCount)?s:0,n.adBreak=i.sessionFlags.likelyBreak;else try{var r;n.adBreak=null!=(r=null==a||null==a.getPodIndex?void 0:a.getPodIndex())?r:0,i.sessionFlags.likelyBreak=n.adBreak}catch(e){n.adBreak=t?i.sessionFlags.likelyBreak:0}try{var l;n.adBreakPos=(null!=(l=null==a||null==a.getAdPosition?void 0:a.getAdPosition())?l:1)-1,i.sessionFlags.likelyBreakPos=n.adBreakPos}catch(e){n.adBreakPos=t?i.sessionFlags.likelyBreakPos:0}n.adGid=i.utils.sessionId+"-"+n.adBreak+"-"+n.adBreakPos;try{var d=null==a||null==a.getTotalAds?void 0:a.getTotalAds();i.sessionFlags.totalAds||(i.sessionFlags.totalAds={}),i.sessionFlags.totalAds[n.adBreak]=d}catch(e){}}else t&&(n.adBreak=i.sessionFlags.likelyBreak,n.adBreakPos=i.sessionFlags.likelyBreakPos,n.adGid=i.utils.sessionId+"-"+n.adBreak+"-"+n.adBreakPos);return n},i._adError=function(e,t){var n,a,s={type:"error"};e&&("string"==typeof e?s.err=e:(s.st=null==e||null==e.getType?void 0:e.getType(),s.err=null==e||null==e.getVastErrorCode?void 0:e.getVastErrorCode(),s.err2=null==e||null==e.getErrorCode?void 0:e.getErrorCode(),Object.assign(s,i._getAdPod(t,!0)),null!=(n=i.sessionFlags)&&null!=(a=n.totalAds)&&a[i.sessionFlags.likelyBreak]?i.sessionFlags.likelyBreakPos<i.sessionFlags.totalAds[i.sessionFlags.likelyBreak]-1?i.sessionFlags.likelyBreakPos++:(i.sessionFlags.likelyBreak++,i.sessionFlags.likelyBreakPos=0):i.sessionFlags.likelyBreakPos++));return s.adURL=i.sessionFlags.lastAdURL,s},i.PLAYER_EVENTS={mediasequenceinitialized:function(){return i.sessionFlags.resetOnInit&&i.resetState(),i.sessionFlags.resetOnInit=!0,{type:"init"}},mediasequenceended:function(){i.resetState()},admanagerloaded:function(e){e.data.adManager.addEventListener("log",(function(e){i.player.dispatch("wtat-log",{originalEvent:e})}))},adrequest:function(e){var t,n,a,s,o,r,l=(null==e||null==(t=e.detail)||null==(n=t.adsRequest)?void 0:n.adTagUrl)||(null==(a=i.player.ads)||null==(s=a.proxy)?void 0:s.adTagUrl),d={type:"serve",adURL:l,adMgV:i.getAdMgV()};return i.sessionFlags.serveCount=(null!=(o=null==(r=i.sessionFlags)?void 0:r.serveCount)?o:-1)+1,i.sessionFlags.lastAdURL=l,i.getIsLive()&&(i.sessionFlags.likelyBreak=i.sessionFlags.serveCount,i.sessionFlags.likelyBreakPos=0),d},adbreakstart:function(){var e;i.getIsLive()||!(i.sessionFlags.likelyBreak>0)||null!=(e=i.sessionFlags.podEndedRanFor)&&e.includes(i.sessionFlags.likelyBreak-1)||i.sessionFlags.likelyBreak++,i.sessionFlags.likelyBreakPos=0},adbreakend:function(e){if(i.sessionFlags.podEndedRanFor||(i.sessionFlags.podEndedRanFor=[]),i.sessionFlags.podEndedRanFor.push(i.sessionFlags.likelyBreak),!i.getIsLive()){var t,n,a=null==e||null==(t=e.data)||null==(n=t.metadata)||null==n.getAdPodInfo?void 0:n.getAdPodInfo();if(a)try{i.sessionFlags.likelyBreak=a.getPodIndex()+1}catch(e){i.sessionFlags.likelyBreak++}else i.sessionFlags.likelyBreak++}i.sessionFlags.likelyBreakPos=0},adloaded:function(e){var t,n={type:"al"},a=null==e||null==(t=e.data)?void 0:t.metadata;return n.adURL=i.sessionFlags.lastAdURL,Object.assign(n,i._getAdDetails(a)),Object.assign(n,i._getAdPod(a)),n},adimpression:function(e){var t,n={type:"imp"},a=null==e||null==(t=e.data)?void 0:t.metadata;return Object.assign(n,i._getAdDetails(a)),Object.assign(n,i._getAdPod(a)),n},adstarted:function(e){var t,n={type:"sa",adMU:null==a?void 0:a.getMediaUrl()},a=null==e||null==(t=e.data)?void 0:t.metadata;return Object.assign(n,i._getAdPod(a)),n},adfirstquartile:function(e){var t,n={type:"efq"},a=null==e||null==(t=e.data)?void 0:t.metadata;return Object.assign(n,i._getAdPod(a)),n},admidpoint:function(e){var t,n={type:"esq"},a=null==e||null==(t=e.data)?void 0:t.metadata;return Object.assign(n,i._getAdPod(a)),n},adthirdquartile:function(e){var t,n={type:"etq"},a=null==e||null==(t=e.data)?void 0:t.metadata;return Object.assign(n,i._getAdPod(a)),n},adended:function(e){var t,n={type:"ecp"},a=null==e||null==(t=e.data)?void 0:t.metadata;return Object.assign(n,i._getAdPod(a)),i.sessionFlags.likelyBreakPos++,n},adadclicked:function(e){var t,n={type:"adClick"},a=null==e||null==(t=e.data)?void 0:t.metadata;return Object.assign(n,i._getAdPod(a)),n},"wtat-log":function(e){var t,n;return i._adError(null==(t=e.data.originalEvent)||null==t.getAdData||null==(n=t.getAdData())?void 0:n.adError,e.data.originalEvent.getAd())},aderror:function(e){var t,n;return i._adError(null==e||null==(t=e.data)?void 0:t.error,null==e||null==(n=e.data)?void 0:n.metadata)},error:function(e){var t,n;return{type:"error",st:"player",err:null==e||null==(t=e.data)||null==(n=t.metadata)?void 0:n.message}},loadedmetadata:function(){i.sessionFlags.c0ok=!0},play:function(){if(!i.sessionFlags.play)return i.sessionFlags.play=!0,{type:"play",autoplay:i.getAutoplay()}},playing:function(){if(!i.sessionFlags.c0&&i.sessionFlags.c0ok)return i.sessionFlags.c0=!0,{type:"c0",autoplay:i.getAutoplay()}},mutechange:function(e){var t,n,a,s={type:e.data?"mute":"unmute"},o=null==e||null==(t=e.target)||null==(n=t.ads)||null==(a=n.currentAd)?void 0:a.metadata;return Object.assign(s,i._getAdPod(o)),s},timeupdate:function(e){if(i.sessionFlags.c0){var t=Math.floor(100*e.data/e.player.absoluteDuration);if(!i.sessionFlags.c95&&t>=95)return i.sessionFlags.c95=!0,i.sessionFlags.c75=!0,i.sessionFlags.c50=!0,i.sessionFlags.c25=!0,{type:"c95"};if(!i.sessionFlags.c75&&t>=75)return i.sessionFlags.c75=!0,i.sessionFlags.c50=!0,i.sessionFlags.c25=!0,{type:"c75"};if(!i.sessionFlags.c50&&t>=50)return i.sessionFlags.c50=!0,i.sessionFlags.c25=!0,{type:"c50"};if(!i.sessionFlags.c25&&t>=25)return i.sessionFlags.c25=!0,{type:"c25"}}}},i.start=function(){i.utils=new b(i.options,t(i)),i.log=i.utils.logger("WTAT."+i.SHORT_NAME),i.resetState();for(var e=0,n=Object.entries(k(window,["wtatCustom","events"],{}));e<n.length;e++){var a=n[e],s=a[0],o=a[1];i.PLAYER_EVENTS[s]?i.PLAYER_EVENTS[s]=[i.PLAYER_EVENTS[s],o]:i.PLAYER_EVENTS[s]=o}Object.keys(i.PLAYER_EVENTS).forEach((function(e){i.player.on(e,i._onPlayerEvent)}))},i.resetState=function(){i.log("resetting state"),i.sessionFlags={likelyBreak:0,likelyBreakPos:0},i.utils.createSession()},Object.defineProperty(t(i),I,{writable:!0,value:function(e,n){var s;if("function"==typeof e)try{s=e(n)}catch(e){i.log("Error executing event listener for",n.type,e.message)}else if(!0===e)s={type:n.type};else if(Array.isArray(e)){s=[];for(var r,l=a(e);!(r=l()).done;){var d=r.value;s.push(o(t(i),I)[I](d,n))}}else s=e;return s}}),i._onPlayerEvent=function(e){if(i.PLAYER_EVENTS[e.type]){"timeupdate"!==e.type&&i.log("executing "+e.type);var n=o(t(i),I)[I](i.PLAYER_EVENTS[e.type],e);Array.isArray(n)&&(n=Object.assign.apply(Object,n)),n&&(n.type?i.utils.sendData(n):i.log("Encountered an event without a type. Not sending",e.type,n))}else i.log("Untracked player event triggered",e.type,e)},i.getVideoSlot=function(){return i.player.mediaElement},i.getMediaId=function(){var e,t;return null==(e=i.player)||null==(t=e.media)?void 0:t.guid},i.getPlayerVersion=function(){return i.player.version},i.getAutoplay=function(){return i.player.autoplay&&!i.player.autoplayblocked},i.getAdMgV=function(){var e,t;return null==(e=google)||null==(t=e.ima)?void 0:t.VERSION},i.getIsLive=function(){return Number(i.player.isLive)},i.player=e,i.options=s,i.options.src=i.SHORT_NAME,"debug"===i.options.debug)debugger;return i}return i=n,(s=r).prototype=Object.create(i.prototype),s.prototype.constructor=s,e(s,i),r}(l),B="5.7.2",O={v:B},C={};try{var R=localStorage.getItem("wtDebug"),_=localStorage.getItem("wtUrl");R&&(C.debug=R),_&&(C.wtUrl=_)}catch(e){}function T(e,t){var n=t.config,a=void 0===n?{}:n,s=Object.assign({},O,a,C);return s.wtatCustom&&(window.wtatCustom=window.wtatCustom||{},s.wtatCustom.fields&&(window.wtatCustom.fields=Object.assign({},window.wtatCustom.fields||{},s.wtatCustom.fields)),s.wtatCustom.events&&(window.wtatCustom.events=Object.assign({},window.wtatCustom.events||{},s.wtatCustom.events)),s.wtatCustom.ignoredEvents&&(window.wtatCustom.ignoredEvents=[].concat(window.wtatCustom.ignoredEvents||[],s.wtatCustom.ignoredEvents)),delete s.wtatCustom),new S(e,s).start(),Promise.resolve({})}return akamai.amp.AMP.registerPlugin("wtAdTracer",T),T.VERSION=B,T}();
